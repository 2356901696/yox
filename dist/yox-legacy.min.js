(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.Yox=factory()})(this,function(){"use strict";Object.keys=function(obj){var result=[];for(var key in obj){push(result,key)}return result};Object.freeze=function(obj){return obj};Object.defineProperty=function(obj,key,descriptor){obj[key]=descriptor.value};Object.create=function(proto,descriptor){function Class(){}Class.prototype=proto;proto=new Class;var constructor=descriptor&&descriptor.constructor;if(constructor){proto.constructor=constructor.value}return proto};String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")};Array.prototype.indexOf=function(target){var result=-1;each(this,function(item,index){if(item===target){result=index;return FALSE}});return result};Array.prototype.map=function(fn){var result=[];each(this,function(item,index){result.push(fn(item,index))});return result};Array.prototype.filter=function(fn){var result=[];each(this,function(item,index){if(fn(item,index)){result.push(item)}});return result};Function.prototype.bind=function(context){var fn=this;return function(){return execute(fn,context,toArray(arguments))}};var TRUE=true;var FALSE=false;var NULL=null;var UNDEFINED=undefined;var win=typeof window!=="undefined"?window:NULL;var doc=typeof document!=="undefined"?document:NULL;var noop=function noop(){};var toString=Object.prototype.toString;function is(arg,type){return type==="numeric"?numeric(arg):toString.call(arg).toLowerCase()==="[object "+type+"]"}function func(arg){return is(arg,"function")}function array(arg){return is(arg,"array")}function object(arg){return arg&&is(arg,"object")}function string(arg){return is(arg,"string")}function number(arg){return is(arg,"number")}function boolean(arg){return is(arg,"boolean")}function primitive(arg){return string(arg)||number(arg)||boolean(arg)||arg==NULL}function numeric(arg){return!isNaN(parseFloat(arg))&&isFinite(arg)}var is$1=Object.freeze({is:is,func:func,array:array,object:object,string:string,number:number,"boolean":boolean,primitive:primitive,numeric:numeric});var execute=function(fn,context,args){if(func(fn)){if(array(args)){return fn.apply(context,args)}else{return fn.call(context,args)}}};var slice=Array.prototype.slice;function each(array$$1,callback,reversed){var length=array$$1.length;if(reversed){for(var i=length-1;i>=0;i--){if(callback(array$$1[i],i)===FALSE){break}}}else{for(var _i=0;_i<length;_i++){if(callback(array$$1[_i],_i)===FALSE){break}}}}function merge(){var args=toArray(arguments);var result=[];args.unshift(result);execute(push,NULL,args);return result}function add(action){return function(original){var args=arguments;for(var i=1,len=args.length;i<len;i++){if(array(args[i])){each(args[i],function(item){original[action](item)})}else{original[action](args[i])}}}}var push=add("push");var unshift=add("unshift");function toArray(array$$1){return array(array$$1)?array$$1:slice.call(array$$1)}function toObject(array$$1,key,value){var result={};each(array$$1,function(item){result[key?item[key]:item]=value?item[value]:item});return result}function indexOf(array$$1,item,strict){if(strict!==FALSE){return array$$1.indexOf(item)}else{var index=-1;each(array$$1,function(value,i){if(item==value){index=i;return FALSE}});return index}}function has(array$$1,item,strict){return indexOf(array$$1,item,strict)>=0}function last(array$$1){return array$$1[array$$1.length-1]}function remove(array$$1,item,strict){var index=indexOf(array$$1,item,strict);if(index>=0){array$$1.splice(index,1)}}function falsy(array$$1){return!array(array$$1)||array$$1.length===0}var array$1=Object.freeze({each:each,merge:merge,push:push,unshift:unshift,toArray:toArray,toObject:toObject,indexOf:indexOf,has:has,last:last,remove:remove,falsy:falsy});var magic=function(options){var args=options.args,get=options.get,set=options.set;args=toArray(args);var key=args[0],value=args[1];if(object(key)){execute(set,NULL,key)}else if(string(key)){var _args=args,length=_args.length;if(length===2){execute(set,NULL,args)}else if(length===1){return execute(get,NULL,key)}}};var toNumber=function(str){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(numeric(str)){return+str}return defaultValue};function charAt(str){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return str.charAt(index)}function codeAt(str){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return str.charCodeAt(index)}var CHAR_BLANK="";var CHAR_ASTERISK="*";var CHAR_DOT=".";var CODE_DOT=codeAt(CHAR_DOT);var CHAR_HASH="#";var CODE_HASH=codeAt(CHAR_HASH);var CHAR_DASH="-";var CODE_DASH=codeAt(CHAR_DASH);var CHAR_EQUAL="=";var CODE_EQUAL=codeAt(CHAR_EQUAL);var CHAR_SLASH="/";var CODE_SLASH=codeAt(CHAR_SLASH);var CHAR_COMMA=",";var CODE_COMMA=codeAt(CHAR_COMMA);var CHAR_COLON=":";var CODE_COLON=codeAt(CHAR_COLON);var CHAR_SEMCOL=";";var CODE_SEMCOL=codeAt(CHAR_SEMCOL);var CHAR_SQUOTE="'";var CODE_SQUOTE=codeAt(CHAR_SQUOTE);var CHAR_DQUOTE='"';var CODE_DQUOTE=codeAt(CHAR_DQUOTE);var CHAR_OPAREN="(";var CODE_OPAREN=codeAt(CHAR_OPAREN);var CHAR_CPAREN=")";var CODE_CPAREN=codeAt(CHAR_CPAREN);var CHAR_OBRACK="[";var CODE_OBRACK=codeAt(CHAR_OBRACK);var CHAR_CBRACK="]";var CODE_CBRACK=codeAt(CHAR_CBRACK);var CHAR_OBRACE="{";var CODE_OBRACE=codeAt(CHAR_OBRACE);var CHAR_CBRACE="}";var CODE_CBRACE=codeAt(CHAR_CBRACE);var CHAR_LEFT="<";var CODE_LEFT=codeAt(CHAR_LEFT);var CHAR_RIGHT=">";var CODE_RIGHT=codeAt(CHAR_RIGHT);var CHAR_QUMARK="?";var CODE_QUMARK=codeAt(CHAR_QUMARK);var CHAR_TAB="	";var CODE_TAB=codeAt(CHAR_TAB);var CHAR_BREAKLINE="\n";var CODE_BREAKLINE=codeAt(CHAR_BREAKLINE);var CHAR_WHITESPACE=" ";var CODE_WHITESPACE=codeAt(CHAR_WHITESPACE);function camelCase(str){if(has$2(str,CHAR_DASH)){return str.replace(/-([a-z])/gi,function($0,$1){return $1.toUpperCase()})}return str}function capitalize(str){return charAt(str,0).toUpperCase()+slice$1(str,1)}function falsy$1(str){return!string(str)||str===CHAR_BLANK}function parse(str,separator,pair){var result=[];if(string(str)){(function(){var terms=void 0,key=void 0,value=void 0,item=void 0;each(split(str,separator),function(term){terms=split(term,pair);key=terms[0];value=terms[1];if(key){item={key:trim(key)};if(string(value)){item.value=trim(value)}push(result,item)}})})()}return result}function trim(str){return falsy$1(str)?CHAR_BLANK:str.trim()}function slice$1(str,start,end){return number(end)?str.slice(start,end):str.slice(start)}function split(str,delimiter){return falsy$1(str)?[]:str.split(new RegExp("\\s*"+delimiter.replace(/[.*?]/g,"\\$&")+"\\s*"))}function indexOf$1(str,part){return str.indexOf(part)}function has$2(str,part){return indexOf$1(str,part)>=0}function startsWith(str,part){return indexOf$1(str,part)===0}function endsWith(str,part){return str===part||str.lastIndexOf(part)===part.length}var string$1=Object.freeze({camelCase:camelCase,capitalize:capitalize,falsy:falsy$1,parse:parse,trim:trim,slice:slice$1,split:split,indexOf:indexOf$1,has:has$2,startsWith:startsWith,endsWith:endsWith});var SEPARATOR_KEY=CHAR_DOT;var SEPARATOR_PATH=CHAR_SLASH;var LEVEL_CURRENT=CHAR_DOT;var LEVEL_PARENT=""+CHAR_DOT+CHAR_DOT;function normalize(str){if(!falsy$1(str)&&indexOf$1(str,CHAR_OBRACK)>0&&indexOf$1(str,CHAR_CBRACK)>0){return str.replace(/\[\s*?([\S]+)\s*?\]/g,function($0,$1){var code=codeAt($1);if(code===CODE_SQUOTE||code===CODE_DQUOTE){$1=slice$1($1,1,-1)}return""+SEPARATOR_KEY+$1})}return str}function parse$1(str){return split(normalize(str),SEPARATOR_KEY)}function stringify(keypaths){return keypaths.filter(function(term){return term!==CHAR_BLANK&&term!==LEVEL_CURRENT}).join(SEPARATOR_KEY)}function resolve(base,path){var list=parse$1(base);each(split(path,SEPARATOR_PATH),function(term){if(term===LEVEL_PARENT){list.pop()}else{push(list,normalize(term))}});return stringify(list)}function keys(object$$1){return Object.keys(object$$1)}function each$1(object$$1,callback){each(keys(object$$1),function(key){return callback(object$$1[key],key)})}function has$1(object$$1,key){return object$$1.hasOwnProperty(key)}function extend(){var args=arguments,result=args[0];for(var i=1,len=args.length;i<len;i++){if(object(args[i])){each$1(args[i],function(value,key){result[key]=value})}}return result}function copy(object$$1,deep){var result=object$$1;if(array(object$$1)){result=[];each(object$$1,function(item,index){result[index]=deep?copy(item):item})}else if(object(object$$1)){result={};each$1(object$$1,function(value,key){result[key]=deep?copy(value):value})}return result}function get(object$$1,keypath){if(has$1(object$$1,keypath)){return{value:object$$1[keypath]}}if(string(keypath)&&indexOf$1(keypath,CHAR_DOT)>0){var list=parse$1(keypath);for(var i=0,len=list.length;i<len&&object$$1;i++){if(i<len-1){object$$1=object$$1[list[i]]}else if(has$1(object$$1,list[i])){return{value:object$$1[list[i]]}}}}}function set(object$$1,keypath,value,autofill){if(string(keypath)&&indexOf$1(keypath,CHAR_DOT)>0){var originalObject=object$$1;var list=parse$1(keypath);var prop=list.pop();each(list,function(item,index){if(object$$1[item]){object$$1=object$$1[item]}else if(autofill!==FALSE){object$$1=object$$1[item]={}}else{object$$1=NULL;return FALSE}});if(object$$1&&object$$1!==originalObject){object$$1[prop]=value}}else{object$$1[keypath]=value}}var object$1=Object.freeze({keys:keys,each:each$1,has:has$1,extend:extend,copy:copy,get:get,set:set});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var inherits=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass};var possibleConstructorReturn=function(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self};var Store=function(){function Store(){classCallCheck(this,Store);this.data={}}createClass(Store,[{key:"get",value:function get$$1(key){return this.data[key]}},{key:"getAsync",value:function getAsync(key,callback){var data=this.data;var value=data[key];if(func(value)){(function(){var $pending=value.$pending;if(!$pending){$pending=value.$pending=[callback];value(function(replacement){delete value.$pending;data[key]=replacement;each($pending,function(callback){callback(replacement)})})}else{push($pending,callback)}})()}else{callback(value)}}},{key:"set",value:function set$$1(key,value){var data=this.data;if(object(key)){each$1(key,function(value,key){data[key]=value})}else if(string(key)){data[key]=value}}}]);return Store}();var Event=function(){function Event(event){classCallCheck(this,Event);if(event.type){this.type=event.type;this.originalEvent=event}else{this.type=event}}createClass(Event,[{key:"prevent",value:function prevent(){if(!this.isPrevented){var originalEvent=this.originalEvent;if(originalEvent&&func(originalEvent.preventDefault)){originalEvent.preventDefault()}this.isPrevented=TRUE}}},{key:"stop",value:function stop(){if(!this.isStoped){var originalEvent=this.originalEvent;if(originalEvent&&func(originalEvent.stopPropagation)){originalEvent.stopPropagation()}this.isStoped=TRUE}}}]);return Event}();var Emitter=function(){function Emitter(options){classCallCheck(this,Emitter);extend(this,options);this.listeners={}}createClass(Emitter,[{key:"on",value:function on(type,listener){var listeners=this.listeners,afterAdd=this.afterAdd;var added=[];var addListener=function addListener(listener,type){if(func(listener)){var list=listeners[type]||(listeners[type]=[]);if(!list.length){push(added,type)}push(list,listener)}};if(object(type)){each$1(type,addListener)}else if(string(type)){addListener(listener,type)}if(added.length&&func(afterAdd)){afterAdd(added)}}},{key:"once",value:function once(type,listener){var instance=this;var addOnce=function addOnce(listener,type){if(func(listener)){listener.$once=function(){instance.off(type,listener);delete listener.$once}}};if(object(type)){each$1(type,addOnce)}else if(string(type)){addOnce(listener,type)}instance.on(type,listener)}},{key:"off",value:function off(type,listener){var listeners=this.listeners,afterRemove=this.afterRemove;var removed=[];if(type==NULL){each$1(listeners,function(list,type){if(array(listeners[type])){listeners[type].length=0;push(removed,type)}})}else{var list=listeners[type];if(array(list)){if(listener==NULL){list.length=0}else{remove(list,listener)}if(!list.length){push(removed,type)}}}if(removed.length&&func(afterRemove)){afterRemove(removed)}}},{key:"fire",value:function fire(type,data,context){if(arguments.length===2){context=NULL}var done=TRUE;var handle=function handle(list,data){if(array(list)){each(list,function(listener){var result=execute(listener,context,data);var $once=listener.$once;if(func($once)){$once()}if(data instanceof Event){if(result===FALSE){data.prevent();data.stop()}else if(data.isStoped){result=FALSE}}if(result===FALSE){return done=FALSE}})}};var listeners=this.listeners;handle(listeners[type],data);if(done){each$1(listeners,function(list,key){if(key!==type||has$2(key,CHAR_ASTERISK)){key=["^",key.replace(/\./g,"\\.").replace(/\*\*/g,"([.\\w]+?)").replace(/\*/g,"(\\w+)"),endsWith(key,""+CHAR_ASTERISK+CHAR_ASTERISK)?CHAR_BLANK:"$"];var match=type.match(new RegExp(key.join(CHAR_BLANK)));if(match){handle(list,merge(data,toArray(match).slice(1)))}return done}})}return done}},{key:"has",value:function has$$1(type,listener){var list=this.listeners[type];if(listener==NULL){return!falsy(list)}return array(list)?has(list,listener):FALSE}}]);return Emitter}();var hasConsole=typeof console!=="undefined";var debug=/yox/.test(noop.toString());function isDebug(){if(win){var DEBUG=win.DEBUG;if(boolean(DEBUG)){return BEBUG}}return debug}function log(msg){if(hasConsole&&isDebug()){console.log("[Yox log]: "+msg)}}function warn(msg){if(hasConsole&&isDebug()){console.warn("[Yox warn]: "+msg)}}function error$1(msg){if(hasConsole){console.error("[Yox error]: "+msg)}}var nextTick=void 0;if(typeof MutationObserver==="function"){nextTick=function nextTick(fn){var activeElement=doc.activeElement;if(activeElement&&"oninput"in activeElement){setTimeout(fn)}else{var observer=new MutationObserver(fn);var textNode=doc.createTextNode(CHAR_BLANK);observer.observe(textNode,{characterData:TRUE});textNode.data=CHAR_WHITESPACE}}}else if(typeof setImmediate==="function"){nextTick=setImmediate}else{nextTick=setTimeout}var nextTick$1=nextTick;var nextTasks=[];function add$1(task){if(!nextTasks.length){nextTick$1(run)}push(nextTasks,task)}function run(){var tasks=nextTasks;nextTasks=[];each(tasks,function(task){task()})}var ARRAY=1;var BINARY=2;var CALL=3;var CONDITIONAL=4;var IDENTIFIER=5;var LITERAL=6;var MEMBER=7;var UNARY=8;var PLUS="+";var MINUS="-";var MULTIPLY="*";var DIVIDE="/";var MODULO="%";var WAVE="~";var AND="&&";var OR="||";var NOT="!";var BOOLEAN="!!";var SE="===";var SNE="!==";var LE="==";var LNE="!=";var LT="<";var LTE="<=";var GT=">";var GTE=">=";function sortKeys(obj){return keys(obj).sort(function(a,b){return b.length-a.length})}var unaryMap={};unaryMap[PLUS]=unaryMap[MINUS]=unaryMap[NOT]=unaryMap[WAVE]=unaryMap[BOOLEAN]=TRUE;var unaryList=sortKeys(unaryMap);var binaryMap={};binaryMap[OR]=1;binaryMap[AND]=2;binaryMap[LE]=binaryMap[LNE]=binaryMap[SE]=binaryMap[SNE]=3;binaryMap[LT]=binaryMap[LTE]=binaryMap[GT]=binaryMap[GTE]=4;binaryMap[PLUS]=binaryMap[MINUS]=5;binaryMap[MULTIPLY]=binaryMap[DIVIDE]=binaryMap[MODULO]=6;var binaryList=sortKeys(binaryMap);var Node=function Node(type){classCallCheck(this,Node);this.type=type};var Array$1=function(_Node){inherits(Array,_Node);function Array(elements){classCallCheck(this,Array);var _this=possibleConstructorReturn(this,(Array.__proto__||Object.getPrototypeOf(Array)).call(this,ARRAY));_this.elements=elements;return _this}return Array}(Node);var Binary=function(_Node){inherits(Binary,_Node);function Binary(left,operator,right){classCallCheck(this,Binary);var _this=possibleConstructorReturn(this,(Binary.__proto__||Object.getPrototypeOf(Binary)).call(this,BINARY));_this.left=left;_this.operator=operator;_this.right=right;return _this}return Binary}(Node);Binary[OR]=function(a,b){return a||b};Binary[AND]=function(a,b){return a&&b};Binary[SE]=function(a,b){return a===b};Binary[SNE]=function(a,b){return a!==b};Binary[LE]=function(a,b){return a==b};Binary[LNE]=function(a,b){return a!=b};Binary[LT]=function(a,b){return a<b};Binary[LTE]=function(a,b){return a<=b};Binary[GT]=function(a,b){return a>b};Binary[GTE]=function(a,b){return a>=b};Binary[PLUS]=function(a,b){return a+b};Binary[MINUS]=function(a,b){return a-b};Binary[MULTIPLY]=function(a,b){return a*b};Binary[DIVIDE]=function(a,b){return a/b};Binary[MODULO]=function(a,b){return a%b};var Call=function(_Node){inherits(Call,_Node);function Call(callee,args){classCallCheck(this,Call);var _this=possibleConstructorReturn(this,(Call.__proto__||Object.getPrototypeOf(Call)).call(this,CALL));_this.callee=callee;_this.args=args;return _this}return Call}(Node);var Conditional=function(_Node){inherits(Conditional,_Node);function Conditional(test,consequent,alternate){classCallCheck(this,Conditional);var _this=possibleConstructorReturn(this,(Conditional.__proto__||Object.getPrototypeOf(Conditional)).call(this,CONDITIONAL));_this.test=test;_this.consequent=consequent;_this.alternate=alternate;return _this}return Conditional}(Node);var Identifier=function(_Node){inherits(Identifier,_Node);function Identifier(name){classCallCheck(this,Identifier);var _this=possibleConstructorReturn(this,(Identifier.__proto__||Object.getPrototypeOf(Identifier)).call(this,IDENTIFIER));_this.name=name;return _this}return Identifier}(Node);var Literal=function(_Node){inherits(Literal,_Node);function Literal(value,raw){classCallCheck(this,Literal);var _this=possibleConstructorReturn(this,(Literal.__proto__||Object.getPrototypeOf(Literal)).call(this,LITERAL));_this.value=value;if(raw){_this.raw=raw}return _this}return Literal}(Node);var Member=function(_Node){inherits(Member,_Node);function Member(object,prop){classCallCheck(this,Member);var _this=possibleConstructorReturn(this,(Member.__proto__||Object.getPrototypeOf(Member)).call(this,MEMBER));_this.object=object;_this.prop=prop;return _this}return Member}(Node);var Unary=function(_Node){inherits(Unary,_Node);function Unary(operator,arg){classCallCheck(this,Unary);var _this=possibleConstructorReturn(this,(Unary.__proto__||Object.getPrototypeOf(Unary)).call(this,UNARY));_this.operator=operator;_this.arg=arg;return _this}return Unary}(Node);Unary[PLUS]=function(value){return+value};Unary[MINUS]=function(value){return-value};Unary[NOT]=function(value){return!value};Unary[WAVE]=function(value){return~value};Unary[BOOLEAN]=function(value){return!!value};function flattenMember(node){var result=[];var next=void 0;do{next=node.object;if(node.type===MEMBER){unshift(result,node.prop)}else{unshift(result,node)}}while(node=next);return result}function stringify$1(node){var recursion=function recursion(node){return stringify$1(node)};switch(node.type){case ARRAY:return"["+node.elements.map(recursion).join(CHAR_COMMA)+"]";case BINARY:return stringify$1(node.left)+" "+node.operator+" "+stringify$1(node.right);case CALL:return stringify$1(node.callee)+"("+node.args.map(recursion).join(CHAR_COMMA)+")";case CONDITIONAL:return stringify$1(node.test)+" ? "+stringify$1(node.consequent)+" : "+stringify$1(node.alternate);case IDENTIFIER:return node.name;case LITERAL:return has$1(node,"raw")?node.raw:node.value;case MEMBER:return flattenMember(node).map(function(node,index){if(node.type===LITERAL){var _node=node,value=_node.value;return numeric(value)?""+CHAR_OBRACK+value+CHAR_CBRACK:""+CHAR_DOT+value}else{node=stringify$1(node);return index>0?""+CHAR_OBRACK+node+CHAR_CBRACK:node}}).join(CHAR_BLANK);case UNARY:return""+node.operator+stringify$1(node.arg);default:return CHAR_BLANK}}function execute$1(node,context){var deps={},value=void 0,result=void 0;(function(){switch(node.type){case ARRAY:value=[];each(node.elements,function(node){result=execute$1(node,context);push(value,result.value);extend(deps,result.deps)});break;case BINARY:var left=node.left,right=node.right;left=execute$1(left,context);right=execute$1(right,context);value=Binary[node.operator](left.value,right.value);extend(deps,left.deps,right.deps);break;case CALL:result=execute$1(node.callee,context);deps=result.deps;value=execute(result.value,NULL,node.args.map(function(node){var result=execute$1(node,context);extend(deps,result.deps);return result.value}));break;case CONDITIONAL:var test=node.test,consequent=node.consequent,alternate=node.alternate;test=execute$1(test,context);if(test.value){consequent=execute$1(consequent,context);value=consequent.value;extend(deps,test.deps,consequent.deps)}else{alternate=execute$1(alternate,context);value=alternate.value;extend(deps,test.deps,alternate.deps)}break;case IDENTIFIER:result=context.get(node.name);value=result.value;deps[result.keypath]=value;break;case LITERAL:value=node.value;break;case MEMBER:var keys$$1=[];each(flattenMember(node),function(node,index){var type=node.type;if(type!==LITERAL){if(index>0){var _result=execute$1(node,context);push(keys$$1,_result.value);extend(deps,_result.deps)}else if(type===IDENTIFIER){push(keys$$1,node.name)}}else{push(keys$$1,node.value)}});result=context.get(stringify(keys$$1));value=result.value;deps[result.keypath]=value;break;case UNARY:result=execute$1(node.arg,context);value=Unary[node.operator](result.value);deps=result.deps;break}})();return{value:value,deps:deps}}var keywords={};keywords["true"]=TRUE;keywords["false"]=FALSE;keywords["null"]=NULL;keywords["undefined"]=UNDEFINED;var compileCache$1={};function isDigit(charCode){return charCode>=48&&charCode<=57}function isIdentifierStart(charCode){return charCode===36||charCode===95||charCode>=97&&charCode<=122||charCode>=65&&charCode<=90}function isIdentifierPart(charCode){return isIdentifierStart(charCode)||isDigit(charCode)}function matchBestToken(content,sortedTokens){var result=void 0;each(sortedTokens,function(token){if(startsWith(content,token)){result=token;return FALSE}});return result}function compile$1(content){if(has$1(compileCache$1,content)){return compileCache$1[content]}var length=content.length;var index=0,charCode=void 0;var getCharCode=function getCharCode(){return codeAt(content,index)};var throwError=function throwError(){error$1("Failed to compile expression: "+CHAR_BREAKLINE+content)};var skipWhitespace=function skipWhitespace(){while((charCode=getCharCode())&&(charCode===CODE_WHITESPACE||charCode===CODE_TAB)){index++}};var skipNumber=function skipNumber(){if(getCharCode()===CODE_DOT){skipDecimal()}else{skipDigit();if(getCharCode()===CODE_DOT){skipDecimal()}}};var skipDigit=function skipDigit(){do{index++}while(isDigit(getCharCode()))};var skipDecimal=function skipDecimal(){index++;if(isDigit(getCharCode())){skipDigit()}else{throwError()}};var skipString=function skipString(){var quote=getCharCode();index++;while(index<length){index++;if(codeAt(content,index-1)===quote){return}}throwError()};var skipIdentifier=function skipIdentifier(){do{index++}while(isIdentifierPart(getCharCode()))};var parseIdentifier=function parseIdentifier(careKeyword){var literal=content.substring(index,(skipIdentifier(),index));if(literal){return careKeyword&&has$1(keywords,literal)?new Literal(keywords[literal]):new Identifier(literal)}throwError()};var parseTuple=function parseTuple(delimiter){var list=[];index++;while(index<length){charCode=getCharCode();if(charCode===delimiter){index++;return list}else if(charCode===CODE_COMMA){index++}else{push(list,parseExpression())}}throwError()};var parseOperator=function parseOperator(sortedOperatorList){skipWhitespace();var literal=matchBestToken(slice$1(content,index),sortedOperatorList);if(literal){index+=literal.length;return literal}};var parseVariable=function parseVariable(){var node=parseIdentifier(TRUE);while(index<length){charCode=getCharCode();if(charCode===CODE_OPAREN){return new Call(node,parseTuple(CODE_CPAREN))}else{if(charCode===CODE_DOT){index++;node=new Member(node,new Literal(parseIdentifier().name))}else if(charCode===CODE_OBRACK){node=new Member(node,parseExpression(CODE_CBRACK))}else{break}}}return node};var parseToken=function parseToken(){skipWhitespace();charCode=getCharCode();if(charCode===CODE_SQUOTE||charCode===CODE_DQUOTE){var value=content.substring(index,(skipString(),index));return new Literal(slice$1(value,1,-1),value)}else if(isDigit(charCode)||charCode===CODE_DOT){return new Literal(parseFloat(content.substring(index,(skipNumber(),index))))}else if(charCode===CODE_OBRACK){return new Array$1(parseTuple(CODE_CBRACK))}else if(charCode===CODE_OPAREN){return parseExpression(CODE_CPAREN)}else if(isIdentifierStart(charCode)){return parseVariable()}var action=parseOperator(unaryList);if(action){return new Unary(action,parseToken())}throwError()};var parseBinary=function parseBinary(){var left=parseToken();var action=parseOperator(binaryList);if(!action){return left}var stack=[left,action,binaryMap[action],parseToken()];var right=void 0,next=void 0;while(next=parseOperator(binaryList)){if(stack.length>3&&binaryMap[next]<stack[stack.length-2]){right=stack.pop();stack.pop();action=stack.pop();left=stack.pop();push(stack,new Binary(left,action,right))}push(stack,next,binaryMap[next],parseToken())}right=stack.pop();while(stack.length>1){stack.pop();action=stack.pop();left=stack.pop();right=new Binary(left,action,right)}return right};var parseExpression=function parseExpression(delimiter){if(delimiter){index++}var test=parseBinary();skipWhitespace();if(getCharCode()===CODE_QUMARK){index++;var consequent=parseBinary();skipWhitespace();if(getCharCode()===CODE_COLON){index++;var alternate=parseBinary();skipWhitespace();return new Conditional(test,consequent,alternate)}else{throwError()}}if(delimiter){if(getCharCode()===delimiter){index++}else{throwError()}}return test};return compileCache$1[content]=parseExpression()}var IF="#if";var ELSE="else";var ELSE_IF="else if";var EACH="#each";var PARTIAL="#partial";var IMPORT=">";var COMMENT=":";var SPREAD="...";var SPECIAL_EVENT="$event";var SPECIAL_KEYPATH="$keypath";var DIRECTIVE_CUSTOM_PREFIX="o-";var DIRECTIVE_EVENT_PREFIX="on-";var DIRECTIVE_REF="ref";var DIRECTIVE_LAZY="lazy";var DIRECTIVE_MODEL="model";var KEYWORD_UNIQUE="key";var DELIMITER_OPENING="(?:\\{)?\\{\\{\\s*";var DELIMITER_CLOSING="\\s*\\}\\}(?:\\})?";var IF$1=1;var ELSE_IF$1=2;var ELSE$1=3;var EACH$1=4;var PARTIAL$1=5;var IMPORT$1=6;var EXPRESSION=7;var SPREAD$1=8;var DIRECTIVE=9;var ELEMENT=10;var ATTRIBUTE=11;var TEXT=12;var Context=function(){function Context(data,parent){classCallCheck(this,Context);this.data=copy(data);this.parent=parent;this.cache={}}createClass(Context,[{key:"push",value:function push$$1(data){return new Context(data,this)}},{key:"pop",value:function pop(){return this.parent}},{key:"format",value:function format(keypath){var instance=this,keys$$1=parse$1(keypath);if(keys$$1[0]==="this"){keys$$1.shift();return{keypath:stringify(keys$$1),instance:instance}}else{var _ret=function(){var lookup=TRUE,index=0;var levelMap={};levelMap[LEVEL_CURRENT]=FALSE;levelMap[LEVEL_PARENT]=TRUE;each(keys$$1,function(key,i){if(has$1(levelMap,key)){lookup=FALSE;if(levelMap[key]){instance=instance.parent;if(!instance){return FALSE}}}else{index=i;return FALSE}});return{v:{keypath:stringify(keys$$1.slice(index)),instance:instance,lookup:lookup}}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}}},{key:"set",value:function set$$1(key,value){var _format=this.format(key),instance=_format.instance,keypath=_format.keypath;if(instance&&keypath){if(has$1(instance.cache,keypath)){delete instance.cache[keypath]}set(instance.data,keypath,value)}}},{key:"get",value:function get$$1(key){var _format2=this.format(key),instance=_format2.instance,keypath=_format2.keypath,lookup=_format2.lookup;if(instance){var _instance=instance,data=_instance.data,cache=_instance.cache;if(!has$1(cache,keypath)){if(keypath){var result=void 0;if(lookup){var keys$$1=[keypath];while(instance){result=get(instance.data,keypath);if(result){break}else{instance=instance.parent;unshift(keys$$1,LEVEL_PARENT)}}keypath=keys$$1.join(SEPARATOR_PATH)}else{result=get(data,keypath)}if(result){cache[keypath]=result.value}}else{cache[keypath]=data}}if(has$1(cache,keypath)){return{keypath:keypath,value:cache[keypath]}}}warn('Failed to lookup "'+key+'" data.');return{keypath:key}}}]);return Context}();var Scanner=function(){function Scanner(str){classCallCheck(this,Scanner);this.init(str)}createClass(Scanner,[{key:"init",value:function init(str){this.pos=0;this.tail=str}},{key:"hasNext",value:function hasNext(){return this.tail}},{key:"nextAfter",value:function nextAfter(pattern){var tail=this.tail;var matches=tail.match(pattern);if(!matches||matches.index){return CHAR_BLANK}var result=matches[0];this.forward(result.length);return result}},{key:"nextBefore",value:function nextBefore(pattern){var pos=this.pos,tail=this.tail;var matches=tail.match(pattern);if(matches){var index=matches.index;if(!index){return CHAR_BLANK}var result=tail.substr(0,index);this.forward(index);return result}else{this.forward(tail.length);return tail}}},{key:"forward",value:function forward(offset){this.pos+=offset;this.tail=slice$1(this.tail,offset)}},{key:"charAt",value:function charAt$$1(index){return charAt(this.tail,index)}},{key:"codeAt",value:function codeAt$$1(index){return codeAt(this.tail,index)}}]);return Scanner}();var Node$2=function(){function Node(type){classCallCheck(this,Node);this.type=type}createClass(Node,[{key:"addChild",value:function addChild(child){push(this.children||(this.children=[]),child)}}]);return Node}();var Attribute=function(_Node){inherits(Attribute,_Node);function Attribute(name){classCallCheck(this,Attribute);var _this=possibleConstructorReturn(this,(Attribute.__proto__||Object.getPrototypeOf(Attribute)).call(this,ATTRIBUTE));_this.name=name;return _this}return Attribute}(Node$2);var Directive=function(_Node){inherits(Directive,_Node);function Directive(name,modifier){classCallCheck(this,Directive);var _this=possibleConstructorReturn(this,(Directive.__proto__||Object.getPrototypeOf(Directive)).call(this,DIRECTIVE));_this.name=name;if(modifier){_this.modifier=modifier}return _this}return Directive}(Node$2);var Each=function(_Node){inherits(Each,_Node);function Each(expr,index){classCallCheck(this,Each);var _this=possibleConstructorReturn(this,(Each.__proto__||Object.getPrototypeOf(Each)).call(this,EACH$1));_this.expr=expr;if(index){_this.index=index}return _this}return Each}(Node$2);var Element=function(_Node){inherits(Element,_Node);function Element(name,component){classCallCheck(this,Element);var _this=possibleConstructorReturn(this,(Element.__proto__||Object.getPrototypeOf(Element)).call(this,ELEMENT));
_this.name=name;if(component){_this.component=component}return _this}createClass(Element,[{key:"addAttr",value:function addAttr(child){push(this.attrs||(this.attrs=[]),child)}}]);return Element}(Node$2);var Else=function(_Node){inherits(Else,_Node);function Else(){classCallCheck(this,Else);return possibleConstructorReturn(this,(Else.__proto__||Object.getPrototypeOf(Else)).call(this,ELSE$1))}return Else}(Node$2);var ElseIf=function(_Node){inherits(ElseIf,_Node);function ElseIf(expr){classCallCheck(this,ElseIf);var _this=possibleConstructorReturn(this,(ElseIf.__proto__||Object.getPrototypeOf(ElseIf)).call(this,ELSE_IF$1));_this.expr=expr;return _this}return ElseIf}(Node$2);var Expression=function(_Node){inherits(Expression,_Node);function Expression(expr,safe){classCallCheck(this,Expression);var _this=possibleConstructorReturn(this,(Expression.__proto__||Object.getPrototypeOf(Expression)).call(this,EXPRESSION));_this.expr=expr;_this.safe=safe;return _this}return Expression}(Node$2);var If=function(_Node){inherits(If,_Node);function If(expr){classCallCheck(this,If);var _this=possibleConstructorReturn(this,(If.__proto__||Object.getPrototypeOf(If)).call(this,IF$1));_this.expr=expr;return _this}return If}(Node$2);var Import=function(_Node){inherits(Import,_Node);function Import(name){classCallCheck(this,Import);var _this=possibleConstructorReturn(this,(Import.__proto__||Object.getPrototypeOf(Import)).call(this,IMPORT$1));_this.name=name;return _this}return Import}(Node$2);var Partial=function(_Node){inherits(Partial,_Node);function Partial(name){classCallCheck(this,Partial);var _this=possibleConstructorReturn(this,(Partial.__proto__||Object.getPrototypeOf(Partial)).call(this,PARTIAL$1));_this.name=name;return _this}return Partial}(Node$2);var Spread=function(_Node){inherits(Spread,_Node);function Spread(expr){classCallCheck(this,Spread);var _this=possibleConstructorReturn(this,(Spread.__proto__||Object.getPrototypeOf(Spread)).call(this,SPREAD$1));_this.expr=expr;return _this}return Spread}(Node$2);var Text=function(_Node){inherits(Text,_Node);function Text(content){classCallCheck(this,Text);var _this=possibleConstructorReturn(this,(Text.__proto__||Object.getPrototypeOf(Text)).call(this,TEXT));_this.content=content;return _this}return Text}(Node$2);var openingDelimiterPattern=new RegExp(DELIMITER_OPENING);var closingDelimiterPattern=new RegExp(DELIMITER_CLOSING);var openingTagPattern=/<(?:\/)?[-a-z]\w*/i;var closingTagPattern=/(?:\/)?>/;var attributePattern=/([-:@a-z0-9]+)(?==["'])?/i;var componentNamePattern=/[-A-Z]/;var selfClosingTagNamePattern=/input|img|br/i;var toString$1=Function.prototype.toString;var ifTypes={};ifTypes[IF$1]=ifTypes[ELSE_IF$1]=TRUE;var elseTypes={};elseTypes[ELSE_IF$1]=elseTypes[ELSE$1]=TRUE;var attrTypes={};attrTypes[ATTRIBUTE]=attrTypes[DIRECTIVE]=TRUE;var leafTypes={};leafTypes[EXPRESSION]=leafTypes[IMPORT$1]=leafTypes[SPREAD$1]=leafTypes[TEXT]=TRUE;var buildInDirectives={};buildInDirectives[DIRECTIVE_REF]=buildInDirectives[DIRECTIVE_LAZY]=buildInDirectives[DIRECTIVE_MODEL]=buildInDirectives[KEYWORD_UNIQUE]=TRUE;function markNodes(nodes){if(array(nodes)){nodes[CHAR_DASH]=TRUE}return nodes}function isNodes(nodes){return array(nodes)&&nodes[CHAR_DASH]===TRUE}function mergeNodes(nodes){if(array(nodes)){switch(nodes.length){case 0:return CHAR_BLANK;case 1:return nodes[0];default:return nodes.join(CHAR_BLANK)}}}function render(ast,createComment,createText,createElement,importTemplate,data){var keys$$1=[];var getKeypath=function getKeypath(){return stringify(keys$$1)};getKeypath.toString=getKeypath;data[SPECIAL_KEYPATH]=getKeypath;var context=new Context(data);var isAttrRendering=void 0;var partials={};var deps={};var executeExpr=function executeExpr(expr){var result=execute$1(expr,context);each$1(result.deps,function(value,key){deps[resolve(getKeypath(),key)]=value});return result.value};var traverseTree=function traverseTree(node,enter,leave){var value=enter(node);if(value!==FALSE){if(!value){var children=node.children,attrs=node.attrs;if(children){children=traverseList(children)}if(attrs){attrs=traverseList(attrs)}value=leave(node,children,attrs)}return value}};var traverseList=function traverseList(nodes){var list=[],i=0,node=void 0,value=void 0;while(node=nodes[i]){value=recursion(node,nodes[i+1]);if(value!==UNDEFINED){if(isNodes(value)){push(list,value)}else{list.push(value)}if(ifTypes[node.type]){while(node=nodes[i+1]){if(elseTypes[node.type]){i++}else{break}}}}i++}return markNodes(list)};var recursion=function recursion(node,nextNode){return traverseTree(node,function(node){var type=node.type,name=node.name,expr=node.expr;var _ret=function(){switch(type){case PARTIAL$1:partials[name]=node;return{v:FALSE};case IMPORT$1:var partial=partials[name]||importTemplate(name);if(partial){if(string(partial)){partial=compile$$1(partial)}else if(partial.type===PARTIAL$1){partial=partial.children}return{v:array(partial)?traverseList(partial):recursion(partial)}}error$1('Importing partial "'+name+'" is not found.');break;case IF$1:case ELSE_IF$1:if(!executeExpr(expr)){return{v:isAttrRendering||!nextNode||elseTypes[nextNode.type]?FALSE:markNodes(createComment())}}break;case EACH$1:var index=node.index,children=node.children;var value=executeExpr(expr);var iterate=void 0;if(array(value)){iterate=each}else if(object(value)){iterate=each$1}else{return{v:FALSE}}var list=[];push(keys$$1,normalize(stringify$1(expr)));context=context.push(value);iterate(value,function(item,i){if(index){context.set(index,i)}push(keys$$1,i);context=context.push(item);push(list,traverseList(children));keys$$1.pop();context=context.pop()});keys$$1.pop();context=context.pop();return{v:markNodes(list)}}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v;if(attrTypes[type]){isAttrRendering=TRUE}},function(node,children,attrs){var type=node.type,name=node.name,modifier=node.modifier,component=node.component,content=node.content;var keypath=getKeypath();if(attrTypes[type]){isAttrRendering=FALSE}var _ret2=function(){switch(type){case TEXT:return{v:markNodes(createText({keypath:keypath,content:content}))};case EXPRESSION:var expr=node.expr,safe=node.safe;content=executeExpr(expr);if(func(content)&&content.toString!==toString$1){content=content.toString()}content=createText({safe:safe,keypath:keypath,content:content});return{v:safe?content:markNodes(content)};case ATTRIBUTE:return{v:{name:name,keypath:keypath,value:mergeNodes(children)}};case DIRECTIVE:return{v:{name:name,modifier:modifier,keypath:keypath,value:mergeNodes(children)}};case IF$1:case ELSE_IF$1:case ELSE$1:return{v:children};case SPREAD$1:content=executeExpr(node.expr);if(object(content)){var _ret3=function(){var list=[];each$1(content,function(value,name){push(list,{name:name,value:value,keypath:keypath})});return{v:{v:markNodes(list)}}}();if((typeof _ret3==="undefined"?"undefined":_typeof(_ret3))==="object")return _ret3.v}break;case ELEMENT:var attributes=[],directives=[];if(attrs){each(attrs,function(node){if(has$1(node,"modifier")){if(node.name&&node.modifier!==CHAR_BLANK){push(directives,node)}}else{push(attributes,node)}})}return{v:createElement({name:name,keypath:keypath,attributes:attributes,directives:directives,children:children||[]},component)}}}();if((typeof _ret2==="undefined"?"undefined":_typeof(_ret2))==="object")return _ret2.v})};return{node:recursion(ast),deps:deps}}var compileCache={};function slicePrefix(str,prefix){return trim(slice$1(str,prefix.length))}function isBreakline(content){return has$2(content,CHAR_BREAKLINE)&&!trim(content)}function trimBreakline(content){return content.replace(/^[ \t]*\n|\n[ \t]*$/g,CHAR_BLANK)}var parsers=[{test:function test(source){return startsWith(source,EACH)},create:function create(source,terms){terms=split(slicePrefix(source,EACH),CHAR_COLON);if(terms[0]){return new Each(compile$1(terms[0]),terms[1])}}},{test:function test(source){return startsWith(source,IMPORT)},create:function create(source){source=slicePrefix(source,IMPORT);if(source){return new Import(source)}}},{test:function test(source){return startsWith(source,PARTIAL)},create:function create(source){source=slicePrefix(source,PARTIAL);if(source){return new Partial(source)}}},{test:function test(source){return startsWith(source,IF)},create:function create(source){source=slicePrefix(source,IF);if(source){return new If(compile$1(source))}}},{test:function test(source){return startsWith(source,ELSE_IF)},create:function create(source){source=slicePrefix(source,ELSE_IF);if(source){return new ElseIf(compile$1(source))}}},{test:function test(source){return startsWith(source,ELSE)},create:function create(source){return new Else}},{test:function test(source){return startsWith(source,SPREAD)},create:function create(source){source=slicePrefix(source,SPREAD);if(source){return new Spread(compile$1(source))}}},{test:function test(source){return!startsWith(source,COMMENT)},create:function create(source,delimiter){source=trim(source);if(source){return new Expression(compile$1(source),!endsWith(delimiter,"}}}"))}}}];function compile$$1(template){var result=compileCache[template];if(result){return result}var nodes=[];var content=void 0;var name=void 0;var mainScanner=new Scanner(template);var helperScanner=new Scanner;var nodeStack=[];var currentNode=void 0,levelNode=void 0;var throwError=function throwError(msg,pos){if(pos==NULL){msg+=CHAR_DOT}else{(function(){var line=0,col=0,index=0;each(template.split(CHAR_BREAKLINE),function(lineStr){line++;col=0;var length=lineStr.length;if(pos>=index&&pos<=index+length){col=pos-index;return FALSE}index+=length});msg+=", at line "+line+", col "+col+"."})()}error$1(""+msg+CHAR_BREAKLINE+template)};var pushStack=function pushStack(node){if(currentNode){push(nodeStack,currentNode)}else{push(nodes,node)}currentNode=node;if(attrTypes[node.type]){levelNode=node}};var popStack=function popStack(){if(attrTypes[currentNode.type]){each(nodeStack,function(node){if(node.type===ELEMENT){levelNode=node;return FALSE}},TRUE)}currentNode=nodeStack.pop()};var addChild=function addChild(node){var type=node.type,content=node.content;if(type===TEXT){if(isBreakline(content)||!(content=trimBreakline(content))){return}node.content=content}if(currentNode){if(levelNode&&levelNode.type===ELEMENT&&currentNode.addAttr){currentNode.addAttr(node)}else{currentNode.addChild(node)}}if(!leafTypes[type]){pushStack(node)}return node};var parseAttribute=function parseAttribute(content){if(falsy(levelNode.children)){if(content&&codeAt(content)===CODE_EQUAL){result=charAt(content,1);content=slice$1(content,2)}else{popStack();return content}}var i=0,currentChar=void 0,closed=void 0;while(currentChar=charAt(content,i)){if(currentChar===result){closed=TRUE;break}i++}if(i){addChild(new Text(slice$1(content,0,i)));content=slice$1(content,closed?i+1:i)}if(closed){popStack()}return content};var parseContent=function parseContent(content){helperScanner.init(content);while(helperScanner.hasNext()){content=helperScanner.nextBefore(openingDelimiterPattern);helperScanner.nextAfter(openingDelimiterPattern);if(content){if(levelNode&&attrTypes[levelNode.type]){content=parseAttribute(content)}if(levelNode&&levelNode.type===ELEMENT){while(content&&(result=attributePattern.exec(content))){content=slice$1(content,result.index+result[0].length);name=result[1];if(buildInDirectives[name]){addChild(new Directive(camelCase(name)))}else{if(startsWith(name,DIRECTIVE_EVENT_PREFIX)){name=name.slice(DIRECTIVE_EVENT_PREFIX.length);addChild(new Directive("event",camelCase(name)))}else if(startsWith(name,DIRECTIVE_CUSTOM_PREFIX)){name=name.slice(DIRECTIVE_CUSTOM_PREFIX.length);addChild(new Directive(camelCase(name)))}else{if(levelNode.component){name=camelCase(name)}addChild(new Attribute(name))}}content=parseAttribute(content)}}else if(content){addChild(new Text(content))}}content=helperScanner.nextBefore(closingDelimiterPattern);name=helperScanner.nextAfter(closingDelimiterPattern);if(content){if(codeAt(content)===CODE_SLASH){popStack()}else{each(parsers,function(parser,index){if(parser.test(content,name)){index=parser.create(content,name);if(index){if(elseTypes[index.type]){popStack()}addChild(index)}else{throwError("Expected expression",mainScanner.pos+helperScanner.pos)}return FALSE}})}}}};while(mainScanner.hasNext()){content=mainScanner.nextBefore(openingTagPattern);if(content){parseContent(content)}if(mainScanner.codeAt(0)!==CODE_LEFT){break}if(mainScanner.codeAt(1)===CODE_SLASH){content=mainScanner.nextAfter(openingTagPattern);name=slice$1(content,2);if(mainScanner.codeAt(0)!==CODE_RIGHT){return throwError("Illegal tag name",mainScanner.pos)}else if(name!==currentNode.name){return throwError("Unexpected closing tag",mainScanner.pos)}popStack();mainScanner.forward(1)}else{content=mainScanner.nextAfter(openingTagPattern);name=slice$1(content,1);levelNode=addChild(new Element(name,componentNamePattern.test(name)));content=mainScanner.nextBefore(closingTagPattern);if(content){parseContent(content)}content=mainScanner.nextAfter(closingTagPattern);if(!content){return throwError("Illegal tag name",mainScanner.pos)}if(levelNode.component||selfClosingTagNamePattern.test(levelNode.name)||codeAt(content)===CODE_SLASH){popStack()}levelNode=NULL}}if(nodeStack.length){return throwError("Expected end tag (</"+nodeStack[0].name+">)",mainScanner.pos)}return compileCache[template]=nodes[0]}var tag=/<[^>]+>/;var selector=/^[#.]\w+$/;var BEFORE_CREATE="beforeCreate";var AFTER_CREATE="afterCreate";var BEFORE_MOUNT="beforeMount";var AFTER_MOUNT="afterMount";var BEFORE_UPDATE="beforeUpdate";var AFTER_UPDATE="afterUpdate";var BEFORE_DESTROY="beforeDestroy";var AFTER_DESTROY="afterDestroy";var Vnode=function Vnode(options){classCallCheck(this,Vnode);extend(this,options)};Vnode.SEL_COMMENT="!";var SVGElement=win.SVGElement;function createElement(tagName,parentNode){return tagName==="svg"||parentNode&&SVGElement&&parentNode instanceof SVGElement?doc.createElementNS("http://www.w3.org/2000/svg",tagName):doc.createElement(tagName)}function createFragment(content){var fragment=doc.createDocumentFragment();if(content){html(fragment,content)}return fragment}function createText(text){return doc.createTextNode(text||CHAR_BLANK)}function createComment(text){return doc.createComment(text||CHAR_BLANK)}function createEvent(event){return event}function isElement(node){return node.nodeType===1}function isFragment(node){return node.nodeType===11}function before(parentNode,newNode,referenceNode){if(referenceNode){parentNode.insertBefore(newNode,referenceNode)}else{append(parentNode,newNode)}}function replace(parentNode,newNode,oldNode){parentNode.replaceChild(newNode,oldNode)}function remove$1(parentNode,child){parentNode.removeChild(child)}function append(parentNode,child){parentNode.appendChild(child)}function parent(node){return node.parentNode}function next(node){return node.nextSibling}function tag$1(node){var tagName=node.tagName;return falsy$1(tagName)?CHAR_BLANK:tagName.toLowerCase()}function children(node){return node.childNodes}function text(node,content){node.nodeValue=content}function html(node,content){if(isElement(node)){node.innerHTML=content}else if(isFragment(node)){each(children(node),function(child){remove$1(node,child)});var element=createElement("div");element.innerHTML=content;each(children(element),function(child){append(node,child)})}}function find(selector,context){return(context||doc).querySelector(selector)}function on(element,type,listener){element.addEventListener(type,listener,FALSE)}function off(element,type,listener){element.removeEventListener(type,listener,FALSE)}var api=Object.freeze({createElement:createElement,createFragment:createFragment,createText:createText,createComment:createComment,createEvent:createEvent,isElement:isElement,isFragment:isFragment,before:before,replace:replace,remove:remove$1,append:append,parent:parent,next:next,tag:tag$1,children:children,text:text,html:html,find:find,on:on,off:off});var HOOK_INIT="init";var HOOK_CREATE="create";var HOOK_INSERT="insert";var HOOK_REMOVE="remove";var HOOK_DESTROY="destroy";var HOOK_PRE="pre";var HOOK_POST="post";var HOOK_PREPATCH="prepatch";var HOOK_UPDATE="update";var HOOK_POSTPATCH="postpatch";var moduleHooks=[HOOK_CREATE,HOOK_UPDATE,HOOK_REMOVE,HOOK_DESTROY,HOOK_PRE,HOOK_POST];var emptyNode=new Vnode({sel:CHAR_BLANK,data:{},children:[]});function isSameVnode(vnode1,vnode2){return vnode1.key===vnode2.key&&vnode1.sel===vnode2.sel}function createKeyToIndex(vnodes,startIndex,endIndex){var result={};for(var i=startIndex,key;i<=endIndex;i++){key=vnodes[i].key;if(key!=NULL){result[key]=i}}return result}function init(modules){var api=arguments.length>1&&arguments[1]!==undefined?arguments[1]:api;var moduleEmitter=new Emitter;each(moduleHooks,function(hook){each(modules,function(item){moduleEmitter.on(hook,item[hook])})});var stringifySel=function stringifySel(el){var list=[api.tag(el)];var id=el.id,className=el.className;if(id){push(list,""+CHAR_HASH+id)}if(className){push(list,""+CHAR_DOT+split(className,CHAR_BLANK).join(CHAR_DOT))}return list.join(CHAR_BLANK)};var parseSel=function parseSel(sel){var tagName=void 0,id=void 0,className=void 0;var hashIndex=indexOf$1(sel,CHAR_HASH);if(hashIndex>0){tagName=slice$1(sel,0,hashIndex);sel=slice$1(sel,hashIndex+1)}var dotIndex=indexOf$1(sel,CHAR_DOT);if(dotIndex>0){var temp=slice$1(sel,0,dotIndex);if(tagName){id=temp}else{tagName=temp}className=split(slice$1(sel,dotIndex+1),CHAR_DOT).join(CHAR_WHITESPACE)}else{if(tagName){id=sel}else{tagName=sel}}return{tagName:tagName,id:id,className:className}};var createVnode=function createVnode(el){return new Vnode({sel:stringifySel(el),data:{},children:[],el:el})};var createElement$$1=function createElement$$1(parentNode,vnode,insertedQueue){var sel=vnode.sel,data=vnode.data,children$$1=vnode.children,raw=vnode.raw,text$$1=vnode.text;var hook=data&&data.hook||{};execute(hook[HOOK_INIT],NULL,vnode);if(falsy$1(sel)){return vnode.el=api[raw?"createFragment":"createText"](text$$1)}if(sel===Vnode.SEL_COMMENT){return vnode.el=api.createComment(text$$1)}var _parseSel=parseSel(sel),tagName=_parseSel.tagName,id=_parseSel.id,className=_parseSel.className;var el=api.createElement(tagName,parentNode);if(id){el.id=id}if(className){el.className=className}vnode.el=el;if(array(children$$1)){addVnodes(el,children$$1,0,children$$1.length-1,insertedQueue)}else if(string(text$$1)){api.append(el,api[raw?"createFragment":"createText"](text$$1))}if(data){data=[emptyNode,vnode];moduleEmitter.fire(HOOK_CREATE,data);execute(hook[HOOK_CREATE],NULL,data);if(hook[HOOK_INSERT]){insertedQueue.push(vnode)}}return el};var addVnodes=function addVnodes(parentNode,vnodes,startIndex,endIndex,insertedQueue,before$$1){for(var i=startIndex;i<=endIndex;i++){addVnode(parentNode,vnodes[i],insertedQueue,before$$1)}};var addVnode=function addVnode(parentNode,vnode,insertedQueue,before$$1){api.before(parentNode,createElement$$1(parentNode,vnode,insertedQueue),before$$1)};var removeVnodes=function removeVnodes(parentNode,vnodes,startIndex,endIndex){for(var i=startIndex;i<=endIndex;i++){removeVnode(parentNode,vnodes[i])}};var removeVnode=function removeVnode(parentNode,vnode){var sel=vnode.sel,el=vnode.el,data=vnode.data;if(sel){destroyVnode(vnode);api.remove(parentNode,el);if(data){moduleEmitter.fire(HOOK_REMOVE,vnode);if(data.hook){execute(data.hook[HOOK_REMOVE],NULL,vnode)}}}else{api.remove(parentNode,el)}};var destroyVnode=function destroyVnode(vnode){var data=vnode.data,children$$1=vnode.children;if(data){if(children$$1){each(children$$1,function(child){destroyVnode(child)})}moduleEmitter.fire(HOOK_DESTROY,vnode);if(data.hook){execute(data.hook[HOOK_DESTROY],NULL,vnode)}}};var replaceVnode=function replaceVnode(parentNode,oldVnode,vnode){if(parentNode){api.before(parentNode,vnode.el,oldVnode.el);removeVnode(parentNode,oldVnode)}};var updateChildren=function updateChildren(parentNode,oldChildren,newChildren,insertedQueue){var oldStartIndex=0;var oldEndIndex=oldChildren.length-1;var oldStartVnode=oldChildren[oldStartIndex];var oldEndVnode=oldChildren[oldEndIndex];var newStartIndex=0;var newEndIndex=newChildren.length-1;var newStartVnode=newChildren[newStartIndex];var newEndVnode=newChildren[newEndIndex];var oldKeyToIndex=void 0,oldIndex=void 0,activeVnode=void 0;while(oldStartIndex<=oldEndIndex&&newStartIndex<=newEndIndex){if(!oldStartVnode){oldStartVnode=oldChildren[++oldStartIndex]}else if(!oldEndVnode){oldEndVnode=oldChildren[--oldEndIndex]}else if(isSameVnode(oldStartVnode,newStartVnode)){patchVnode(oldStartVnode,newStartVnode,insertedQueue);oldStartVnode=oldChildren[++oldStartIndex];newStartVnode=newChildren[++newStartIndex]}else if(isSameVnode(oldEndVnode,newEndVnode)){patchVnode(oldEndVnode,newEndVnode,insertedQueue);oldEndVnode=oldChildren[--oldEndIndex];newEndVnode=newChildren[--newEndIndex]}else if(isSameVnode(oldStartVnode,newEndVnode)){patchVnode(oldStartVnode,newEndVnode,insertedQueue);api.before(parentNode,oldStartVnode.el,api.next(oldEndVnode.el));oldStartVnode=oldChildren[++oldStartIndex];newEndVnode=newChildren[--newEndIndex]}else if(isSameVnode(oldEndVnode,newStartVnode)){patchVnode(oldEndVnode,newStartVnode,insertedQueue);api.before(parentNode,oldEndVnode.el,oldStartVnode.el);oldEndVnode=oldChildren[--oldEndIndex];newStartVnode=newChildren[++newStartIndex]}else{if(!oldKeyToIndex){oldKeyToIndex=createKeyToIndex(oldChildren,oldStartIndex,oldEndIndex)}oldIndex=oldKeyToIndex[newStartVnode.key];if(number(oldIndex)){activeVnode=oldChildren[oldIndex];patchVnode(activeVnode,newStartVnode,insertedQueue);oldChildren[oldIndex]=NULL}else{createElement$$1(parentNode,newStartVnode,insertedQueue);activeVnode=newStartVnode}api.before(parentNode,activeVnode.el,oldStartVnode.el);newStartVnode=newChildren[++newStartIndex]}}if(oldStartIndex>oldEndIndex){activeVnode=newChildren[newEndIndex+1];addVnodes(parentNode,newChildren,newStartIndex,newEndIndex,insertedQueue,activeVnode?activeVnode.el:NULL)}else if(newStartIndex>newEndIndex){removeVnodes(parentNode,oldChildren,oldStartIndex,oldEndIndex)}};var patchVnode=function patchVnode(oldVnode,vnode,insertedQueue){if(oldVnode===vnode){return}var data=vnode.data;var hook=data&&data.hook||{};var args=[oldVnode,vnode];execute(hook[HOOK_PREPATCH],NULL,args);var el=vnode.el=oldVnode.el;vnode.payload=oldVnode.payload;var parentNode=api.parent(el);if(!isSameVnode(oldVnode,vnode)){createElement$$1(parentNode,vnode,insertedQueue);replaceVnode(parentNode,oldVnode,vnode);return}if(data){moduleEmitter.fire(HOOK_UPDATE,args);execute(hook[HOOK_UPDATE],NULL,args)}var newRaw=vnode.raw;var newText=vnode.text;var newChildren=vnode.children;var oldRaw=oldVnode.raw;var oldText=oldVnode.text;var oldChildren=oldVnode.children;if(string(newText)){if(newText!==oldText){if(newRaw){api.replace(parentNode,api.createFragment(newText),el)}else{api.text(el,newText)}}}else{if(newChildren&&oldChildren){if(newChildren!==oldChildren){updateChildren(el,oldChildren,newChildren,insertedQueue)}}else if(newChildren){if(string(oldText)){api[oldRaw?"html":"text"](el,CHAR_BLANK)}addVnodes(el,newChildren,0,newChildren.length-1,insertedQueue)}else if(oldChildren){removeVnodes(el,oldChildren,0,oldChildren.length-1)}else if(string(oldText)){api[oldRaw?"html":"text"](el,CHAR_BLANK)}}execute(hook[HOOK_POSTPATCH],NULL,args)};return function(oldVnode,vnode){moduleEmitter.fire(HOOK_PRE);if(api.isElement(oldVnode)){oldVnode=createVnode(oldVnode)}var insertedQueue=[];if(isSameVnode(oldVnode,vnode)){patchVnode(oldVnode,vnode,insertedQueue)}else{var parentNode=api.parent(oldVnode.el);createElement$$1(parentNode,vnode,insertedQueue);replaceVnode(parentNode,oldVnode,vnode)}each(insertedQueue,function(vnode){execute(vnode.data.hook[HOOK_INSERT],NULL,vnode)});moduleEmitter.fire(HOOK_POST);return vnode}}var h=function(sel,data){var children=void 0,text=void 0;var lastArg=last(arguments);if(array(lastArg)){children=lastArg;each(children,function(child,i){if(!(child instanceof Vnode)){children[i]=new Vnode({text:child})}})}else if(string(lastArg)){text=lastArg}return new Vnode({sel:sel,text:text,children:children,data:object(data)?data:{}})};function updateStyle(oldVnode,vnode){var oldStyle=oldVnode.data.style;var newStyle=vnode.data.style;if(!oldStyle&&!newStyle){return}oldStyle=oldStyle||{};newStyle=newStyle||{};var style=vnode.el.style;each$1(newStyle,function(value,name){if(value!==oldStyle[name]){style[name]=value}});each$1(oldStyle,function(value,name){if(!has$1(newStyle,name)){style[name]=CHAR_BLANK}})}var style={create:updateStyle,update:updateStyle};var booleanLiteral="allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare"+"default,defaultchecked,defaultmuted,defaultselected,defer,disabled,draggable"+"enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple"+"muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly"+"required,reversed,scoped,seamless,selected,sortable,spellcheck,translate"+"truespeed,typemustmatch,visible";var booleanMap=toObject(split(booleanLiteral,CHAR_COMMA));function updateAttrs(oldVnode,vnode){var oldAttrs=oldVnode.data.attrs;var newAttrs=vnode.data.attrs;if(!oldAttrs&&!newAttrs){return}oldAttrs=oldAttrs||{};newAttrs=newAttrs||{};var el=vnode.el;each$1(newAttrs,function(value,name){if(value!==oldAttrs[name]){if(!value&&booleanMap[name]){el.removeAttribute(name)}else{el.setAttribute(name,value)}}});each$1(oldAttrs,function(value,name){if(!has$1(newAttrs,name)){el.removeAttribute(name)}})}var attributes={create:updateAttrs,update:updateAttrs};var toString$2=function(str){var defaultValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:CHAR_BLANK;try{return str.toString()}catch(e){return defaultValue}};var clickType="click";var inputType="input";var changeType="change";var propertychangeType="propertychange";var IEEvent=function(){function IEEvent(event,element){classCallCheck(this,IEEvent);extend(this,event);this.currentTarget=element;this.target=event.srcElement||element;this.originalEvent=event}createClass(IEEvent,[{key:"preventDefault",value:function preventDefault(){this.originalEvent.returnValue=FALSE}},{key:"stopPropagation",value:function stopPropagation(){this.originalEvent.cancelBubble=TRUE}}]);return IEEvent}();function addInputListener(element,listener){listener.$listener=function(e){if(e.propertyName==="value"){e=new Event(e);e.type=inputType;listener.call(this,e)}};on$1(element,propertychangeType,listener.$listener)}function removeInputListener(element,listener){off$1(element,propertychangeType,listener.$listener);delete listener.$listener}function addChangeListener(element,listener){listener.$listener=function(e){e=new Event(e);e.type=changeType;listener.call(this,e)};on$1(element,clickType,listener.$listener)}function removeChangeListener(element,listener){off$1(element,clickType,listener.$listener);delete listener.$listener}function isBox(element){return element.tagName==="INPUT"||element.type==="radio"||element.type==="checkbox"}function on$1(element,type,listener){if(type===inputType){addInputListener(element,listener)}else if(type===changeType&&isBox(element)){addChangeListener(element,listener)}else{element.attachEvent("on"+type,listener)}}function off$1(element,type,listener){if(type===inputType){removeInputListener(element,listener)}else if(type===changeType&&isBox(element)){removeChangeListener(element,listener)}else{element.detachEvent("on"+type,listener)}}function createEvent$1(event,element){return new IEEvent(event,element)}var oldApi=Object.freeze({on:on$1,off:off$1,createEvent:createEvent$1});if(!doc.addEventListener){extend(api,oldApi)}var patch=init([attributes,style],api);function create(ast,context,instance){var createComment=function createComment(){return h(Vnode.SEL_COMMENT)};var createText=function createText(node){var safe=node.safe,content=node.content;if(safe!==FALSE||!string(content)||!tag.test(content)){return content}return new Vnode({text:content,raw:TRUE})};var createElement=function createElement(node,isComponent){var hooks={},attributes$$1={},directives={},styles=void 0,component=void 0;var data={hook:hooks};if(!isComponent){each(node.attributes,function(node){var name=node.name,value=node.value;if(name==="style"){var list=parse(value,CHAR_SEMCOL,CHAR_COLON);if(list.length){styles={};each(list,function(item){if(item.value){styles[camelCase(item.key)]=item.value}})}}else{attributes$$1[name]=node;var attrs=data.attrs||(data.attrs={});attrs[name]=value}})}each(node.directives,function(node){var name=node.name,modifier=node.modifier;if(name===KEYWORD_UNIQUE){data.key=node.value}else{name=modifier?""+name+CHAR_DOT+modifier:name;if(!directives[name]){directives[name]=node}}});if(styles){data.style=styles}hooks.insert=hooks.postpatch=hooks.destroy=function(oldVnode,vnode){var nextVnode=vnode||oldVnode;var payload=oldVnode.payload||(oldVnode.payload={});var destroies=payload.destroies||(payload.destroies={});var oldComponent=payload.component;var oldDirectives=payload.directives;if(oldComponent){component=oldComponent;if(object(component)){component.set(toObject(node.attributes,"name","value"),TRUE)}}else if(isComponent){component=payload.component=[];instance.component(node.name,function(options){if(array(component)){oldComponent=component;component=payload.component=instance.create(options,{el:nextVnode.el,props:toObject(node.attributes,"name","value"),replace:TRUE});each(oldComponent,function(callback){callback(component)})}})}var bind=function bind(key){var node=directives[key];return execute(instance.directive(node.name),NULL,{el:nextVnode.el,node:node,instance:instance,directives:directives,attributes:attributes$$1,component:component})};each$1(directives,function(directive,key){if(vnode&&oldDirectives){var oldDirective=oldDirectives[key];if(oldDirective){if(oldDirective.value!==directive.value){if(destroies[key]){destroies[key]()}destroies[key]=bind(key)}return}}destroies[key]=bind(key)});if(oldDirectives){each$1(oldDirectives,function(oldDirective,key){if(destroies[key]&&(!vnode||!directives[key])){destroies[key]();delete destroies[key]}})}payload.attributes=attributes$$1;payload.directives=directives;hooks.insert=hooks.postpatch=hooks.destroy=noop};return h(isComponent?"div":node.name,data,node.children.map(function(child){return child instanceof Vnode?child:toString$2(child)}))};var importTemplate=function importTemplate(name){return instance.partial(name)};return render(ast,createComment,createText,createElement,importTemplate,context)}var find$1=api.find;var isElement$1=api.isElement;function create$1(tagName,parentNode){if(parentNode){api.html(parentNode,"<"+tagName+"></"+tagName+">");return api.children(parentNode)[0]}return api.createElement(tagName)}function getContent(selector){return api.find(selector).innerHTML}function on$2(element,type,listener,context){var $emitter=element.$emitter||(element.$emitter=new Emitter);if(!$emitter.has(type)){var nativeListener=function nativeListener(e){if(!(e instanceof Event)){e=new Event(api.createEvent(e,element))}$emitter.fire(e.type,e,context)};$emitter[type]=nativeListener;api.on(element,type,nativeListener)}$emitter.on(type,listener)}function off$2(element,type,listener){var $emitter=element.$emitter;var types=keys($emitter.listeners);$emitter.off(type,listener);each(types,function(type){if($emitter[type]&&!$emitter.has(type)){api.off(element,type,$emitter[type]);delete $emitter[type]}})}var native=Object.freeze({find:find$1,isElement:isElement$1,create:create$1,getContent:getContent,on:on$2,off:off$2});var ref=function(_ref){var el=_ref.el,node=_ref.node,instance=_ref.instance,component=_ref.component;var value=node.value;if(falsy$1(value)){return}var $refs=instance.$refs;if(object($refs)){if(has$1($refs,value)){error$1('Passing a ref "'+value+'" is existed.')}}else{$refs=instance.$refs={}}var set$$1=function set$$1(target){$refs[value]=target};if(component){if(array(component)){push(component,set$$1)}else{set$$1(component)}}else{set$$1(el)}return function(){if(has$1($refs,value)){delete $refs[value]
}else if(array(component)){remove(component,set$$1)}}};var debounce=function(fn,delay,immediate){var timer=void 0;return function(){var _arguments=arguments;if(!timer){(function(){var args=toArray(_arguments);if(immediate){execute(fn,NULL,args)}timer=setTimeout(function(){timer=NULL;if(!immediate){execute(fn,NULL,args)}},delay)})()}}};var immediateTypes=["click","tap"];var event=function(_ref){var el=_ref.el,node=_ref.node,instance=_ref.instance,component=_ref.component,directives=_ref.directives,type=_ref.type,listener=_ref.listener;if(!type){type=node.modifier}if(!listener){listener=instance.compileValue(node.keypath,node.value)}if(type&&listener){var lazy=directives.lazy;if(lazy){if(numeric(lazy.value)&&lazy.value>=0){listener=debounce(listener,lazy.value,has(immediateTypes,type))}else if(type==="input"){type="change"}}if(component){var _ret=function(){var bind=function bind(component){component.on(type,listener)};if(array(component)){push(component,bind)}else{bind(component)}return{v:function v(){component.off(type,listener);if(array(component)){remove(component,bind)}}}}();if((typeof _ret==="undefined"?"undefined":_typeof(_ret))==="object")return _ret.v}else{on$2(el,type,listener);return function(){off$2(el,type,listener)}}}};var inputControl={set:function set$$1(_ref){var el=_ref.el,keypath=_ref.keypath,instance=_ref.instance;var value=toString$2(instance.get(keypath));if(value!==el.value){el.value=value}},sync:function sync(_ref2){var el=_ref2.el,keypath=_ref2.keypath,instance=_ref2.instance;instance.set(keypath,el.value)}};var selectControl={set:function set$$1(_ref3){var el=_ref3.el,keypath=_ref3.keypath,instance=_ref3.instance;var value=toString$2(instance.get(keypath));var options=el.options,selectedIndex=el.selectedIndex;if(value!==options[selectedIndex].value){each(options,function(option,index){if(options.value===value){el.selectedIndex=index;return FALSE}})}},sync:function sync(_ref4){var el=_ref4.el,keypath=_ref4.keypath,instance=_ref4.instance;var value=el.options[el.selectedIndex].value;instance.set(keypath,value)}};var radioControl={set:function set$$1(_ref5){var el=_ref5.el,keypath=_ref5.keypath,instance=_ref5.instance;el.checked=el.value===toString$2(instance.get(keypath))},sync:function sync(_ref6){var el=_ref6.el,keypath=_ref6.keypath,instance=_ref6.instance;if(el.checked){instance.set(keypath,el.value)}}};var checkboxControl={set:function set$$1(_ref7){var el=_ref7.el,keypath=_ref7.keypath,instance=_ref7.instance;var value=instance.get(keypath);el.checked=array(value)?has(value,el.value,FALSE):boolean(value)?value:!!value},sync:function sync(_ref8){var el=_ref8.el,keypath=_ref8.keypath,instance=_ref8.instance;var value=instance.get(keypath);if(array(value)){if(el.checked){push(value,el.value)}else{remove(value,el.value,FALSE)}instance.set(keypath,copy(value))}else{instance.set(keypath,el.checked)}}};var specialControls={radio:radioControl,checkbox:checkboxControl,SELECT:selectControl};var model=function(_ref9){var el=_ref9.el,node=_ref9.node,instance=_ref9.instance,directives=_ref9.directives,attributes=_ref9.attributes;var value=node.value,keypath=node.keypath;var result=instance.get(value,keypath);if(result){keypath=result.keypath}else{error$1("The "+keypath+" being used for two-way binding is ambiguous.");return}var type="change",tagName=el.tagName,controlType=el.type;var control=specialControls[controlType]||specialControls[tagName];if(!control){control=inputControl;if("oninput"in el||tagName==="TEXTAREA"||controlType==="text"||controlType==="password"){type="input"}}var data={el:el,keypath:keypath,instance:instance};var set$$1=function set$$1(){control.set(data)};if(!has$1(attributes,"value")){set$$1()}instance.watch(keypath,set$$1);return event({el:el,node:node,instance:instance,directives:directives,type:type,listener:function listener(){control.sync(data)}})};var Yox=function(){function Yox(options){classCallCheck(this,Yox);var instance=this;execute(options[BEFORE_CREATE],instance,options);var el=options.el,data=options.data,props=options.props,parent=options.parent,replace=options.replace,computed=options.computed,template=options.template,watchers=options.watchers,components=options.components,directives=options.directives,events=options.events,filters=options.filters,methods=options.methods,partials=options.partials,extensions=options.extensions;instance.$options=options;if(props&&!object(props)){props=NULL}if(props&&data&&!func(data)){warn('Passing a "data" option should be a function.')}instance.$data=props||{};extend(instance.$data,func(data)?execute(data,instance):data);if(object(computed)){instance.$computedGetters={};instance.$computedSetters={};instance.$computedStack=[];instance.$computedDeps={};each$1(computed,function(item,keypath){var get$$1=void 0,set$$1=void 0,deps=void 0,cache=TRUE;if(func(item)){get$$1=item}else if(object(item)){if(boolean(item.cache)){cache=item.cache}if(array(item.deps)){deps=item.deps}if(func(item.get)){get$$1=item.get}if(func(item.set)){set$$1=item.set}}if(get$$1){(function(){var watcher=function watcher(){getter.$dirty=TRUE};var getter=function getter(){if(!getter.$dirty){if(cache&&has$1($watchCache,keypath)){return $watchCache[keypath]}}else{delete getter.$dirty}if(!deps){instance.$computedStack.push([])}var result=execute(get$$1,instance);var newDeps=deps||instance.$computedStack.pop();var oldDeps=instance.$computedDeps[keypath];if(newDeps!==oldDeps){updateDeps(instance,newDeps,oldDeps,watcher)}instance.$computedDeps[keypath]=newDeps;$watchCache[keypath]=result;return result};getter.toString=getter;instance.$computedGetters[keypath]=getter})()}if(set$$1){instance.$computedSetters[keypath]=set$$1}})}instance.$eventEmitter=new Emitter;instance.on(events);var $watchCache=instance.$watchCache={};instance.$watchEmitter=new Emitter({afterAdd:function afterAdd(added){each(added,function(keypath){if(!has$2(keypath,CHAR_ASTERISK)&&!has$1($watchCache,keypath)){$watchCache[keypath]=instance.get(keypath)}})},afterRemove:function afterRemove(removed){each(removed,function(keypath){if(has$1($watchCache,keypath)){delete $watchCache[keypath]}})}});instance.watch(watchers);execute(options[AFTER_CREATE],instance);if(string(template)){if(selector.test(template)){template=getContent(template)}if(!tag.test(template)){error$1('Passing a "template" option must have a root element.')}}else{template=NULL}if(string(el)){if(selector.test(el)){el=find$1(el)}}if(el){if(isElement$1(el)){if(!replace){el=create$1("div",el)}}else{error$1('Passing a "el" option must be a html element.')}}if(parent){instance.$parent=parent}if(methods){each$1(methods,function(fn,name){if(has$1(prototype,name)){error$1('Passing a "'+name+'" method is conflicted with built-in methods.')}instance[name]=fn})}extend(instance,extensions);instance.component(components);instance.directive(directives);instance.filter(filters);instance.partial(partials);if(template){instance.$viewWatcher=function(){instance.$dirty=TRUE};execute(options[BEFORE_MOUNT],instance);instance.$template=Yox.compile(template);instance.updateView(el||create$1("div"))}}createClass(Yox,[{key:"get",value:function get$$1(keypath,context){var $data=this.$data,$computedStack=this.$computedStack,$computedGetters=this.$computedGetters;var result=void 0;var getValue=function getValue(keypath){if($computedGetters){result=$computedGetters[keypath];if(result){return{value:result()}}}return get($data,keypath)};keypath=normalize(keypath);if(string(context)){var keys$$1=parse$1(context);while(TRUE){push(keys$$1,keypath);context=stringify(keys$$1);result=getValue(context);if(result||keys$$1.length<=1){if(result){result.keypath=context}return result}else{keys$$1.splice(-2,2)}}}else{if($computedStack){result=last($computedStack);if(result){push(result,keypath)}}result=getValue(keypath);if(result){return result.value}}}},{key:"set",value:function set$$1(keypath,value){var model$$1=void 0,immediate=void 0;if(string(keypath)){model$$1={};model$$1[keypath]=value}else if(object(keypath)){model$$1=copy(keypath);immediate=value===TRUE}else{return}this.updateModel(model$$1,immediate)}},{key:"on",value:function on$$1(type,listener){this.$eventEmitter.on(type,listener)}},{key:"once",value:function once(type,listener){this.$eventEmitter.once(type,listener)}},{key:"off",value:function off$$1(type,listener){this.$eventEmitter.off(type,listener)}},{key:"fire",value:function fire(type,data){var event$$1=data;if(!(event$$1 instanceof Event)){event$$1=new Event(type);if(data){event$$1.data=data}}if(event$$1.type!==type){data=event$$1.data;event$$1=new Event(event$$1);event$$1.type=type;if(data){event$$1.data=data}}var instance=this;var $parent=instance.$parent,$eventEmitter=instance.$eventEmitter;if(!event$$1.target){event$$1.target=instance}var done=$eventEmitter.fire(type,event$$1,instance);if(done&&$parent){done=$parent.fire(type,event$$1)}return done}},{key:"watch",value:function watch(keypath,watcher){this.$watchEmitter.on(keypath,watcher)}},{key:"watchOnce",value:function watchOnce(keypath,watcher){this.$watchEmitter.once(keypath,watcher)}},{key:"unwatch",value:function unwatch(keypath,watcher){this.$watchEmitter.off(keypath,watcher)}},{key:"updateModel",value:function updateModel(model$$1){var instance=this;var $data=instance.$data,$computedSetters=instance.$computedSetters;each$1(model$$1,function(newValue,key){var keypath=normalize(key);if(keypath!==key){delete model$$1[key];model$$1[keypath]=newValue}});each$1(model$$1,function(value,keypath){if($computedSetters){var setter=$computedSetters[keypath];if(setter){setter.call(instance,value);return}}set($data,keypath,value)});var args=arguments,immediate=void 0;if(args.length===1){immediate=instance.$dirtyIgnore=TRUE}else if(args.length===2){immediate=args[1]}if(immediate){diff(instance)}else if(!instance.$diffing){instance.$diffing=TRUE;add$1(function(){delete instance.$diffing;diff(instance)})}}},{key:"updateView",value:function updateView(){var instance=this;var $viewDeps=instance.$viewDeps,$viewWatcher=instance.$viewWatcher,$data=instance.$data,$options=instance.$options,$filters=instance.$filters,$template=instance.$template,$currentNode=instance.$currentNode,$computedGetters=instance.$computedGetters;if($currentNode){execute($options[BEFORE_UPDATE],instance)}var context={};var filter=registry.filter;extend(context,filter&&filter.data,$filters.data);each$1(context,function(value,key){if(func(value)){context[key]=value.bind(instance)}});extend(context,$data,$computedGetters);var _vdom$create=create($template,context,instance),node=_vdom$create.node,deps=_vdom$create.deps;instance.$viewDeps=keys(deps);updateDeps(instance,instance.$viewDeps,$viewDeps,$viewWatcher);var afterHook=void 0;if($currentNode){afterHook=AFTER_UPDATE;$currentNode=patch($currentNode,node)}else{afterHook=AFTER_MOUNT;$currentNode=patch(arguments[0],node);instance.$el=$currentNode.el}instance.$currentNode=$currentNode;execute($options[afterHook],instance)}},{key:"create",value:function create$$1(options,extra){options=extend({},options,extra);var _options=options,props=_options.props,propTypes=_options.propTypes;if(object(props)&&object(propTypes)){options.props=Yox.validate(props,propTypes)}options.parent=this;var child=new Yox(options);var children=this.$children||(this.$children=[]);push(children,child);return child}},{key:"compileValue",value:function compileValue(keypath,value){if(falsy$1(value)){return}var instance=this;if(indexOf$1(value,CHAR_OPAREN)>0){var _ret2=function(){var ast=compile$1(value);if(ast.type===CALL){return{v:function v(event$$1){var isEvent=event$$1 instanceof Event;var args=copy(ast.args);if(!args.length){if(isEvent){push(args,event$$1)}}else{args=args.map(function(node){var name=node.name,type=node.type;if(type===LITERAL){return node.value}if(type===IDENTIFIER){if(name===SPECIAL_EVENT){if(isEvent){return event$$1}}else if(name===SPECIAL_KEYPATH){return keypath}}else if(type===MEMBER){name=stringify$1(node)}var result=instance.get(name,keypath);if(result){return result.value}})}var name=stringify$1(ast.callee);var fn=instance[name];if(!fn){var result=instance.get(name,keypath);if(result){fn=result.value}}execute(fn,instance,args)}}}}();if((typeof _ret2==="undefined"?"undefined":_typeof(_ret2))==="object")return _ret2.v}else{return function(event$$1){instance.fire(value,event$$1)}}}},{key:"destroy",value:function destroy(){var instance=this;var $options=instance.$options,$parent=instance.$parent,$children=instance.$children,$currentNode=instance.$currentNode,$watchEmitter=instance.$watchEmitter,$eventEmitter=instance.$eventEmitter;execute($options[BEFORE_DESTROY],instance);if($children){each($children,function(child){child.destroy()},TRUE)}if($parent&&$parent.$children){remove($parent.$children,instance)}if($currentNode){if(arguments[0]!==TRUE){patch($currentNode,{text:CHAR_BLANK})}}$watchEmitter.off();$eventEmitter.off();each$1(instance,function(value,key){delete instance[key]});execute($options[AFTER_DESTROY],instance)}},{key:"nextTick",value:function nextTick(fn){add$1(fn)}},{key:"toggle",value:function toggle(keypath){var value=!this.get(keypath);this.set(keypath,value);return value}},{key:"increase",value:function increase(keypath,step,max){var value=toNumber(this.get(keypath),0)+(numeric(step)?step:1);if(!numeric(max)||value<=max){this.set(keypath,value)}return value}},{key:"decrease",value:function decrease(keypath,step,min){var value=toNumber(this.get(keypath),0)-(numeric(step)?step:1);if(!numeric(min)||value>=min){this.set(keypath,value)}return value}},{key:"copy",value:function copy$$1(data,deep){return copy(data,deep)}},{key:"log",value:function log$$1(msg){log(msg)}},{key:"warn",value:function warn$$1(msg){warn(msg)}}]);return Yox}();Yox.version="0.26.0";Yox.is=is$1;Yox.array=array$1;Yox.object=object$1;Yox.string=string$1;Yox.native=native;Yox.Event=Event;Yox.Emitter=Emitter;var prototype=Yox.prototype;var registry={};var supportRegisterAsync=["component"];function parseRegisterArguments(type,args){var id=args[0];var value=args[1];var callback=void 0;if(has(supportRegisterAsync,type)&&func(value)){callback=value;value=UNDEFINED}return{callback:callback,args:value===UNDEFINED?[id]:[id,value]}}each(merge(supportRegisterAsync,["directive","filter","partial"]),function(type){prototype[type]=function(){var prop="$"+type+"s";var store=this[prop]||(this[prop]=new Store);var _parseRegisterArgumen=parseRegisterArguments(type,arguments),args=_parseRegisterArgumen.args,callback=_parseRegisterArgumen.callback;return magic({args:args,get:function get$$1(id){if(callback){store.getAsync(id,function(value){if(value){callback(value)}else{Yox[type](id,callback)}})}else{return store.get(id)||Yox[type](id)}},set:function set$$1(id,value){store.set(id,value)}})};Yox[type]=function(){var store=registry[type]||(registry[type]=new Store);var _parseRegisterArgumen2=parseRegisterArguments(type,arguments),args=_parseRegisterArgumen2.args,callback=_parseRegisterArgumen2.callback;return magic({args:args,get:function get$$1(id){if(callback){store.getAsync(id,callback)}else{return store.get(id)}},set:function set$$1(id,value){store.set(id,value)}})}});Yox.nextTick=add$1;Yox.compile=function(template){return falsy$1(template)?template:compile$$1(template)};Yox.validate=function(props,schema){var result={};each$1(schema,function(rule,key){var type=rule.type,value=rule.value,required=rule.required;required=required===TRUE||func(required)&&required(props);if(has$1(props,key)){if(type){(function(){var target=props[key],matched=void 0;if(!falsy$1(type)){matched=is(target,type)}else if(!falsy(type)){each(type,function(t){if(is(target,t)){matched=TRUE;return FALSE}})}else if(func(type)){matched=type(target,props)}if(matched===TRUE){result[key]=target}else if(required){warn('Passing a "'+key+'" prop is not matched.')}})()}}else if(required){warn('Passing a "'+key+'" prop is not found.')}else if(has$1(rule,"value")){result[key]=func(value)?value(props):value}});return result};Yox.use=function(plugin){plugin.install(Yox)};function updateDeps(instance,newDeps,oldDeps,watcher){oldDeps=oldDeps||[];each(newDeps,function(dep){if(!has(oldDeps,dep)){instance.watch(dep,watcher)}});each(oldDeps,function(dep){if(!has(newDeps,dep)){instance.unwatch(dep,watcher)}})}function diff(instance){var $children=instance.$children,$watchCache=instance.$watchCache,$watchEmitter=instance.$watchEmitter,$computedDeps=instance.$computedDeps;var keys$$1=[];var addKey=function addKey(key,push$$1){if(!has(keys$$1,key)){if(push$$1){keys$$1.push(key)}else{keys$$1.unshift(key)}}};var pickDeps=function pickDeps(key){if($computedDeps&&!falsy($computedDeps[key])){each($computedDeps[key],pickDeps);addKey(key,TRUE)}else{addKey(key)}};each$1($watchCache,function(value,key){pickDeps(key)});each(keys$$1,function(key){var oldValue=$watchCache[key];var newValue=instance.get(key);if(newValue!==oldValue){$watchCache[key]=newValue;$watchEmitter.fire(key,[newValue,oldValue,key],instance)}});var $dirty=instance.$dirty,$dirtyIgnore=instance.$dirtyIgnore;if($dirty){delete instance.$dirty}if($dirtyIgnore){delete instance.$dirtyIgnore;return}if($dirty){instance.updateView()}else if($children){each($children,function(child){diff(child)})}}Yox.directive({ref:ref,event:event,model:model});return Yox});