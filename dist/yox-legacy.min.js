!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.Yox=factory()}(this,function(){"use strict";function is(arg,type){return"numeric"===type?numeric(arg):toString.call(arg).toLowerCase()==="[object "+type+"]"}function func(arg){return is(arg,"function")}function array(arg){return is(arg,"array")}function object(arg){return arg&&is(arg,"object")}function string(arg){return is(arg,"string")}function number(arg){return is(arg,"number")}function boolean(arg){return is(arg,"boolean")}function primitive(arg){return string(arg)||number(arg)||boolean(arg)||arg==NULL}function numeric(arg){return!isNaN(parseFloat(arg))&&isFinite(arg)}function each(array$$1,callback,reversed){var length=array$$1.length;if(reversed)for(var i=length-1;i>=0&&callback(array$$1[i],i)!==FALSE;i--);else for(var _i=0;length>_i&&callback(array$$1[_i],_i)!==FALSE;_i++);}function merge(){var args=toArray(arguments),result=[];return args.unshift(result),execute(push,NULL,args),result}function add(action){return function(original){for(var args=arguments,i=1,len=args.length;len>i;i++)array(args[i])?each(args[i],function(item){original[action](item)}):original[action](args[i])}}function toArray(array$$1){return array(array$$1)?array$$1:slice.call(array$$1)}function toObject(array$$1,key,value){var result={};return each(array$$1,function(item){result[key?item[key]:item]=value?item[value]:item}),result}function indexOf(array$$1,item,strict){if(strict!==FALSE)return array$$1.indexOf(item);var index=-1;return each(array$$1,function(value,i){return item==value?(index=i,FALSE):void 0}),index}function has(array$$1,item,strict){return indexOf(array$$1,item,strict)>=0}function last(array$$1){return array$$1[array$$1.length-1]}function remove(array$$1,item,strict){var index=indexOf(array$$1,item,strict);index>=0&&array$$1.splice(index,1)}function falsy(array$$1){return!array(array$$1)||0===array$$1.length}function charAt(str){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return str.charAt(index)}function codeAt(str){var index=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return str.charCodeAt(index)}function camelCase(str){return has$2(str,CHAR_DASH)?str.replace(/-([a-z])/gi,function($0,$1){return $1.toUpperCase()}):str}function capitalize(str){return charAt(str,0).toUpperCase()+slice$1(str,1)}function falsy$1(str){return!string(str)||str===CHAR_BLANK}function parse(str,separator,pair){var result=[];return string(str)&&!function(){var terms=void 0,key=void 0,value=void 0,item=void 0;each(split(str,separator),function(term){terms=split(term,pair),key=terms[0],value=terms[1],key&&(item={key:trim(key)},string(value)&&(item.value=trim(value)),push(result,item))})}(),result}function trim(str){return falsy$1(str)?CHAR_BLANK:str.trim()}function slice$1(str,start,end){return number(end)?str.slice(start,end):str.slice(start)}function split(str,delimiter){return falsy$1(str)?[]:str.split(new RegExp("\\s*"+delimiter.replace(/[.*?]/g,"\\$&")+"\\s*"))}function indexOf$1(str,part){return str.indexOf(part)}function has$2(str,part){return indexOf$1(str,part)>=0}function startsWith(str,part){return 0===indexOf$1(str,part)}function endsWith(str,part){return str===part||str.lastIndexOf(part)===part.length}function normalize(str){return!falsy$1(str)&&indexOf$1(str,CHAR_OBRACK)>0&&indexOf$1(str,CHAR_CBRACK)>0?str.replace(/\[\s*?([\S]+)\s*?\]/g,function($0,$1){var code=codeAt($1);return(code===CODE_SQUOTE||code===CODE_DQUOTE)&&($1=slice$1($1,1,-1)),""+SEPARATOR_KEY+$1}):str}function parse$1(str){return split(normalize(str),SEPARATOR_KEY)}function stringify(keypaths){return keypaths.filter(function(term){return term!==CHAR_BLANK&&term!==LEVEL_CURRENT}).join(SEPARATOR_KEY)}function resolve(base,path){var list=parse$1(base);return each(split(path,SEPARATOR_PATH),function(term){term===LEVEL_PARENT?list.pop():push(list,normalize(term))}),stringify(list)}function keys(object$$1){return Object.keys(object$$1)}function each$1(object$$1,callback){each(keys(object$$1),function(key){return callback(object$$1[key],key)})}function has$1(object$$1,key){return object$$1.hasOwnProperty(key)}function extend(){for(var args=arguments,result=args[0],i=1,len=args.length;len>i;i++)object(args[i])&&each$1(args[i],function(value,key){result[key]=value});return result}function copy(object$$1,deep){var result=object$$1;return array(object$$1)?(result=[],each(object$$1,function(item,index){result[index]=deep?copy(item):item})):object(object$$1)&&(result={},each$1(object$$1,function(value,key){result[key]=deep?copy(value):value})),result}function get(object$$1,keypath){if(has$1(object$$1,keypath))return{value:object$$1[keypath]};if(string(keypath)&&indexOf$1(keypath,CHAR_DOT)>0)for(var list=parse$1(keypath),i=0,len=list.length;len>i&&object$$1;i++)if(len-1>i)object$$1=object$$1[list[i]];else if(has$1(object$$1,list[i]))return{value:object$$1[list[i]]}}function set(object$$1,keypath,value,autofill){if(string(keypath)&&indexOf$1(keypath,CHAR_DOT)>0){var originalObject=object$$1,list=parse$1(keypath),prop=list.pop();each(list,function(item){if(object$$1[item])object$$1=object$$1[item];else{if(autofill===FALSE)return object$$1=NULL,FALSE;object$$1=object$$1[item]={}}}),object$$1&&object$$1!==originalObject&&(object$$1[prop]=value)}else object$$1[keypath]=value}function isDebug(){if(win){var DEBUG=win.DEBUG;if(boolean(DEBUG))return BEBUG}return debug}function log(msg){hasConsole&&isDebug()&&console.log("[Yox log]: "+msg)}function warn(msg){hasConsole&&isDebug()&&console.warn("[Yox warn]: "+msg)}function error$1(msg){hasConsole&&console.error("[Yox error]: "+msg)}function add$1(task){nextTasks.length||nextTick$1(run),push(nextTasks,task)}function run(){var tasks=nextTasks;nextTasks=[],each(tasks,function(task){task()})}function sortKeys(obj){return keys(obj).sort(function(a,b){return b.length-a.length})}function flattenMember(node){var result=[],next=void 0;do next=node.object,node.type===MEMBER?unshift(result,node.prop):unshift(result,node);while(node=next);return result}function stringify$1(node){var recursion=function(node){return stringify$1(node)};switch(node.type){case ARRAY:return"["+node.elements.map(recursion).join(CHAR_COMMA)+"]";case BINARY:return stringify$1(node.left)+" "+node.operator+" "+stringify$1(node.right);case CALL:return stringify$1(node.callee)+"("+node.args.map(recursion).join(CHAR_COMMA)+")";case CONDITIONAL:return stringify$1(node.test)+" ? "+stringify$1(node.consequent)+" : "+stringify$1(node.alternate);case IDENTIFIER:return node.name;case LITERAL:return has$1(node,"raw")?node.raw:node.value;case MEMBER:return flattenMember(node).map(function(node,index){if(node.type===LITERAL){var _node=node,value=_node.value;return numeric(value)?""+CHAR_OBRACK+value+CHAR_CBRACK:""+CHAR_DOT+value}return node=stringify$1(node),index>0?""+CHAR_OBRACK+node+CHAR_CBRACK:node}).join(CHAR_BLANK);case UNARY:return""+node.operator+stringify$1(node.arg);default:return CHAR_BLANK}}function execute$1(node,context){var deps={},value=void 0,result=void 0;return function(){switch(node.type){case ARRAY:value=[],each(node.elements,function(node){result=execute$1(node,context),push(value,result.value),extend(deps,result.deps)});break;case BINARY:var left=node.left,right=node.right;left=execute$1(left,context),right=execute$1(right,context),value=Binary[node.operator](left.value,right.value),extend(deps,left.deps,right.deps);break;case CALL:result=execute$1(node.callee,context),deps=result.deps,value=execute(result.value,NULL,node.args.map(function(node){var result=execute$1(node,context);return extend(deps,result.deps),result.value}));break;case CONDITIONAL:var test=node.test,consequent=node.consequent,alternate=node.alternate;test=execute$1(test,context),test.value?(consequent=execute$1(consequent,context),value=consequent.value,extend(deps,test.deps,consequent.deps)):(alternate=execute$1(alternate,context),value=alternate.value,extend(deps,test.deps,alternate.deps));break;case IDENTIFIER:result=context.get(node.name),value=result.value,deps[result.keypath]=value;break;case LITERAL:value=node.value;break;case MEMBER:var keys$$1=[];each(flattenMember(node),function(node,index){var type=node.type;if(type!==LITERAL)if(index>0){var _result=execute$1(node,context);push(keys$$1,_result.value),extend(deps,_result.deps)}else type===IDENTIFIER&&push(keys$$1,node.name);else push(keys$$1,node.value)}),result=context.get(stringify(keys$$1)),value=result.value,deps[result.keypath]=value;break;case UNARY:result=execute$1(node.arg,context),value=Unary[node.operator](result.value),deps=result.deps}}(),{value:value,deps:deps}}function isDigit(charCode){return charCode>=48&&57>=charCode}function isIdentifierStart(charCode){return 36===charCode||95===charCode||charCode>=97&&122>=charCode||charCode>=65&&90>=charCode}function isIdentifierPart(charCode){return isIdentifierStart(charCode)||isDigit(charCode)}function matchBestToken(content,sortedTokens){var result=void 0;return each(sortedTokens,function(token){return startsWith(content,token)?(result=token,FALSE):void 0}),result}function compile$1(content){if(has$1(compileCache$1,content))return compileCache$1[content];var length=content.length,index=0,charCode=void 0,getCharCode=function(){return codeAt(content,index)},throwError=function(){error$1("Failed to compile expression: "+CHAR_BREAKLINE+content)},skipWhitespace=function(){for(;(charCode=getCharCode())&&(charCode===CODE_WHITESPACE||charCode===CODE_TAB);)index++},skipNumber=function(){getCharCode()===CODE_DOT?skipDecimal():(skipDigit(),getCharCode()===CODE_DOT&&skipDecimal())},skipDigit=function(){do index++;while(isDigit(getCharCode()))},skipDecimal=function(){index++,isDigit(getCharCode())?skipDigit():throwError()},skipString=function(){var quote=getCharCode();for(index++;length>index;)if(index++,codeAt(content,index-1)===quote)return;throwError()},skipIdentifier=function(){do index++;while(isIdentifierPart(getCharCode()))},parseIdentifier=function(careKeyword){var literal=content.substring(index,(skipIdentifier(),index));return literal?careKeyword&&has$1(keywords,literal)?new Literal(keywords[literal]):new Identifier(literal):void throwError()},parseTuple=function(delimiter){var list=[];for(index++;length>index;){if(charCode=getCharCode(),charCode===delimiter)return index++,list;charCode===CODE_COMMA?index++:push(list,parseExpression())}throwError()},parseOperator=function(sortedOperatorList){skipWhitespace();var literal=matchBestToken(slice$1(content,index),sortedOperatorList);return literal?(index+=literal.length,literal):void 0},parseVariable=function(){for(var node=parseIdentifier(TRUE);length>index;){if(charCode=getCharCode(),charCode===CODE_OPAREN)return new Call(node,parseTuple(CODE_CPAREN));if(charCode===CODE_DOT)index++,node=new Member(node,new Literal(parseIdentifier().name));else{if(charCode!==CODE_OBRACK)break;node=new Member(node,parseExpression(CODE_CBRACK))}}return node},parseToken=function parseToken(){if(skipWhitespace(),charCode=getCharCode(),charCode===CODE_SQUOTE||charCode===CODE_DQUOTE){var value=content.substring(index,(skipString(),index));return new Literal(slice$1(value,1,-1),value)}if(isDigit(charCode)||charCode===CODE_DOT)return new Literal(parseFloat(content.substring(index,(skipNumber(),index))));if(charCode===CODE_OBRACK)return new Array$1(parseTuple(CODE_CBRACK));if(charCode===CODE_OPAREN)return parseExpression(CODE_CPAREN);if(isIdentifierStart(charCode))return parseVariable();var action=parseOperator(unaryList);return action?new Unary(action,parseToken()):void throwError()},parseBinary=function(){var left=parseToken(),action=parseOperator(binaryList);if(!action)return left;for(var stack=[left,action,binaryMap[action],parseToken()],right=void 0,next=void 0;next=parseOperator(binaryList);)stack.length>3&&binaryMap[next]<stack[stack.length-2]&&(right=stack.pop(),stack.pop(),action=stack.pop(),left=stack.pop(),push(stack,new Binary(left,action,right))),push(stack,next,binaryMap[next],parseToken());for(right=stack.pop();stack.length>1;)stack.pop(),action=stack.pop(),left=stack.pop(),right=new Binary(left,action,right);return right},parseExpression=function(delimiter){delimiter&&index++;var test=parseBinary();if(skipWhitespace(),getCharCode()===CODE_QUMARK){index++;var consequent=parseBinary();if(skipWhitespace(),getCharCode()===CODE_COLON){index++;var alternate=parseBinary();return skipWhitespace(),new Conditional(test,consequent,alternate)}throwError()}return delimiter&&(getCharCode()===delimiter?index++:throwError()),test};return compileCache$1[content]=parseExpression()}function markNodes(nodes){return array(nodes)&&(nodes[CHAR_DASH]=TRUE),nodes}function isNodes(nodes){return array(nodes)&&nodes[CHAR_DASH]===TRUE}function mergeNodes(nodes){if(array(nodes))switch(nodes.length){case 0:return CHAR_BLANK;case 1:return nodes[0];default:return nodes.join(CHAR_BLANK)}}function render(ast,createComment,createText,createElement,importTemplate,data){var keys$$1=[],getKeypath=function(){return stringify(keys$$1)};getKeypath.toString=getKeypath,data[SPECIAL_KEYPATH]=getKeypath;var context=new Context(data),isAttrRendering=void 0,partials={},deps={},executeExpr=function(expr){var result=execute$1(expr,context);return each$1(result.deps,function(value,key){deps[resolve(getKeypath(),key)]=value}),result.value},traverseTree=function(node,enter,leave){var value=enter(node);if(value!==FALSE){if(!value){var children=node.children,attrs=node.attrs;children&&(children=traverseList(children)),attrs&&(attrs=traverseList(attrs)),value=leave(node,children,attrs)}return value}},traverseList=function(nodes){for(var list=[],i=0,node=void 0,value=void 0;node=nodes[i];){if(value=recursion(node,nodes[i+1]),value!==UNDEFINED&&(isNodes(value)?push(list,value):list.push(value),ifTypes[node.type]))for(;(node=nodes[i+1])&&elseTypes[node.type];)i++;i++}return markNodes(list)},recursion=function recursion(node,nextNode){return traverseTree(node,function(node){var type=node.type,name=node.name,expr=node.expr,_ret=function(){switch(type){case PARTIAL$1:return partials[name]=node,{v:FALSE};case IMPORT$1:var partial=partials[name]||importTemplate(name);if(partial)return string(partial)?partial=compile$$1(partial):partial.type===PARTIAL$1&&(partial=partial.children),{v:array(partial)?traverseList(partial):recursion(partial)};error$1('Importing partial "'+name+'" is not found.');break;case IF$1:case ELSE_IF$1:if(!executeExpr(expr))return{v:isAttrRendering||!nextNode||elseTypes[nextNode.type]?FALSE:markNodes(createComment())};break;case EACH$1:var index=node.index,children=node.children,value=executeExpr(expr),iterate=void 0;if(array(value))iterate=each;else{if(!object(value))return{v:FALSE};iterate=each$1}var list=[];return push(keys$$1,normalize(stringify$1(expr))),context=context.push(value),iterate(value,function(item,i){index&&context.set(index,i),push(keys$$1,i),context=context.push(item),push(list,traverseList(children)),keys$$1.pop(),context=context.pop()}),keys$$1.pop(),context=context.pop(),{v:markNodes(list)}}}();return"object"===("undefined"==typeof _ret?"undefined":_typeof(_ret))?_ret.v:void(attrTypes[type]&&(isAttrRendering=TRUE))},function(node,children,attrs){var type=node.type,name=node.name,modifier=node.modifier,component=node.component,content=node.content,keypath=getKeypath();attrTypes[type]&&(isAttrRendering=FALSE);var _ret2=function(){switch(type){case TEXT:return{v:markNodes(createText({keypath:keypath,content:content}))};case EXPRESSION:var expr=node.expr,safe=node.safe;return content=executeExpr(expr),func(content)&&content.toString!==toString$1&&(content=content.toString()),content=createText({safe:safe,keypath:keypath,content:content}),{v:safe?content:markNodes(content)};case ATTRIBUTE:return{v:{name:name,keypath:keypath,value:mergeNodes(children)}};case DIRECTIVE:return{v:{name:name,modifier:modifier,keypath:keypath,value:mergeNodes(children)}};case IF$1:case ELSE_IF$1:case ELSE$1:return{v:children};case SPREAD$1:if(content=executeExpr(node.expr),object(content)){var _ret3=function(){var list=[];return each$1(content,function(value,name){push(list,{name:name,value:value,keypath:keypath})}),{v:{v:markNodes(list)}}}();if("object"===("undefined"==typeof _ret3?"undefined":_typeof(_ret3)))return _ret3.v}break;case ELEMENT:var attributes=[],directives=[];return attrs&&each(attrs,function(node){has$1(node,"modifier")?node.name&&node.modifier!==CHAR_BLANK&&push(directives,node):push(attributes,node)}),{v:createElement({name:name,keypath:keypath,attributes:attributes,directives:directives,children:children||[]},component)}}}();return"object"===("undefined"==typeof _ret2?"undefined":_typeof(_ret2))?_ret2.v:void 0})};return{node:recursion(ast),deps:deps}}function slicePrefix(str,prefix){return trim(slice$1(str,prefix.length))}function isBreakline(content){return has$2(content,CHAR_BREAKLINE)&&!trim(content)}function trimBreakline(content){return content.replace(/^[ \t]*\n|\n[ \t]*$/g,CHAR_BLANK)}function compile$$1(template){var result=compileCache[template];if(result)return result;for(var nodes=[],content=void 0,name=void 0,mainScanner=new Scanner(template),helperScanner=new Scanner,nodeStack=[],currentNode=void 0,levelNode=void 0,throwError=function(msg,pos){pos==NULL?msg+=CHAR_DOT:!function(){var line=0,col=0,index=0;each(template.split(CHAR_BREAKLINE),function(lineStr){line++,col=0;var length=lineStr.length;return pos>=index&&index+length>=pos?(col=pos-index,FALSE):void(index+=length)}),msg+=", at line "+line+", col "+col+"."}(),error$1(""+msg+CHAR_BREAKLINE+template)},pushStack=function(node){currentNode?push(nodeStack,currentNode):push(nodes,node),currentNode=node,attrTypes[node.type]&&(levelNode=node)},popStack=function(){attrTypes[currentNode.type]&&each(nodeStack,function(node){return node.type===ELEMENT?(levelNode=node,FALSE):void 0},TRUE),currentNode=nodeStack.pop()},addChild=function(node){var type=node.type,content=node.content;if(type===TEXT){if(isBreakline(content)||!(content=trimBreakline(content)))return;node.content=content}return currentNode&&(levelNode&&levelNode.type===ELEMENT&&currentNode.addAttr?currentNode.addAttr(node):currentNode.addChild(node)),leafTypes[type]||pushStack(node),node},parseAttribute=function(content){if(falsy(levelNode.children)){if(!content||codeAt(content)!==CODE_EQUAL)return popStack(),content;result=charAt(content,1),content=slice$1(content,2)}for(var i=0,currentChar=void 0,closed=void 0;currentChar=charAt(content,i);){if(currentChar===result){closed=TRUE;break}i++}return i&&(addChild(new Text(slice$1(content,0,i))),content=slice$1(content,closed?i+1:i)),closed&&popStack(),content},parseContent=function(content){for(helperScanner.init(content);helperScanner.hasNext();){if(content=helperScanner.nextBefore(openingDelimiterPattern),helperScanner.nextAfter(openingDelimiterPattern),content)if(levelNode&&attrTypes[levelNode.type]&&(content=parseAttribute(content)),levelNode&&levelNode.type===ELEMENT)for(;content&&(result=attributePattern.exec(content));)content=slice$1(content,result.index+result[0].length),name=result[1],buildInDirectives[name]?addChild(new Directive(camelCase(name))):startsWith(name,DIRECTIVE_EVENT_PREFIX)?(name=name.slice(DIRECTIVE_EVENT_PREFIX.length),addChild(new Directive("event",camelCase(name)))):startsWith(name,DIRECTIVE_CUSTOM_PREFIX)?(name=name.slice(DIRECTIVE_CUSTOM_PREFIX.length),addChild(new Directive(camelCase(name)))):(levelNode.component&&(name=camelCase(name)),addChild(new Attribute(name))),content=parseAttribute(content);else content&&addChild(new Text(content));content=helperScanner.nextBefore(closingDelimiterPattern),name=helperScanner.nextAfter(closingDelimiterPattern),content&&(codeAt(content)===CODE_SLASH?popStack():each(parsers,function(parser,index){return parser.test(content,name)?(index=parser.create(content,name),index?(elseTypes[index.type]&&popStack(),addChild(index)):throwError("Expected expression",mainScanner.pos+helperScanner.pos),FALSE):void 0}))}};mainScanner.hasNext()&&(content=mainScanner.nextBefore(openingTagPattern),content&&parseContent(content),mainScanner.codeAt(0)===CODE_LEFT);)if(mainScanner.codeAt(1)===CODE_SLASH){if(content=mainScanner.nextAfter(openingTagPattern),name=slice$1(content,2),mainScanner.codeAt(0)!==CODE_RIGHT)return throwError("Illegal tag name",mainScanner.pos);if(name!==currentNode.name)return throwError("Unexpected closing tag",mainScanner.pos);popStack(),mainScanner.forward(1)}else{if(content=mainScanner.nextAfter(openingTagPattern),name=slice$1(content,1),levelNode=addChild(new Element(name,componentNamePattern.test(name))),content=mainScanner.nextBefore(closingTagPattern),content&&parseContent(content),content=mainScanner.nextAfter(closingTagPattern),!content)return throwError("Illegal tag name",mainScanner.pos);(levelNode.component||selfClosingTagNamePattern.test(levelNode.name)||codeAt(content)===CODE_SLASH)&&popStack(),levelNode=NULL}return nodeStack.length?throwError("Expected end tag (</"+nodeStack[0].name+">)",mainScanner.pos):compileCache[template]=nodes[0]}function createElement(tagName,parentNode){return"svg"===tagName||parentNode&&SVGElement&&parentNode instanceof SVGElement?doc.createElementNS("http://www.w3.org/2000/svg",tagName):doc.createElement(tagName)}function createFragment(content){var fragment=doc.createDocumentFragment();return content&&html(fragment,content),fragment}function createText(text){return doc.createTextNode(text||CHAR_BLANK)}function createComment(text){return doc.createComment(text||CHAR_BLANK)}function createEvent(event){return event}function isElement(node){return 1===node.nodeType}function isFragment(node){return 11===node.nodeType}function before(parentNode,newNode,referenceNode){referenceNode?parentNode.insertBefore(newNode,referenceNode):append(parentNode,newNode)}function replace(parentNode,newNode,oldNode){parentNode.replaceChild(newNode,oldNode)}function remove$1(parentNode,child){parentNode.removeChild(child)}function append(parentNode,child){parentNode.appendChild(child)}function parent(node){return node.parentNode}function next(node){return node.nextSibling}function tag$1(node){var tagName=node.tagName;return falsy$1(tagName)?CHAR_BLANK:tagName.toLowerCase()}function children(node){return node.childNodes}function text(node,content){node.nodeValue=content}function html(node,content){if(isElement(node))node.innerHTML=content;else if(isFragment(node)){each(children(node),function(child){remove$1(node,child)});var element=createElement("div");element.innerHTML=content,each(children(element),function(child){append(node,child)})}}function find(selector,context){return(context||doc).querySelector(selector)}function on(element,type,listener){element.addEventListener(type,listener,FALSE)}function off(element,type,listener){element.removeEventListener(type,listener,FALSE)}function isSameVnode(vnode1,vnode2){return vnode1.key===vnode2.key&&vnode1.sel===vnode2.sel}function createKeyToIndex(vnodes,startIndex,endIndex){for(var key,result={},i=startIndex;endIndex>=i;i++)key=vnodes[i].key,key!=NULL&&(result[key]=i);return result}function init(modules){var api=arguments.length>1&&void 0!==arguments[1]?arguments[1]:api,moduleEmitter=new Emitter;each(moduleHooks,function(hook){each(modules,function(item){moduleEmitter.on(hook,item[hook])})});var stringifySel=function(el){var list=[api.tag(el)],id=el.id,className=el.className;return id&&push(list,""+CHAR_HASH+id),className&&push(list,""+CHAR_DOT+split(className,CHAR_BLANK).join(CHAR_DOT)),list.join(CHAR_BLANK)},parseSel=function(sel){var tagName=void 0,id=void 0,className=void 0,hashIndex=indexOf$1(sel,CHAR_HASH);hashIndex>0&&(tagName=slice$1(sel,0,hashIndex),sel=slice$1(sel,hashIndex+1));var dotIndex=indexOf$1(sel,CHAR_DOT);if(dotIndex>0){var temp=slice$1(sel,0,dotIndex);tagName?id=temp:tagName=temp,className=split(slice$1(sel,dotIndex+1),CHAR_DOT).join(CHAR_WHITESPACE)}else tagName?id=sel:tagName=sel;return{tagName:tagName,id:id,className:className}},createVnode=function(el){return new Vnode({sel:stringifySel(el),data:{},children:[],el:el})},createElement$$1=function(parentNode,vnode,insertedQueue){var sel=vnode.sel,data=vnode.data,children$$1=vnode.children,raw=vnode.raw,text$$1=vnode.text,hook=data&&data.hook||{};if(execute(hook[HOOK_INIT],NULL,vnode),falsy$1(sel))return vnode.el=api[raw?"createFragment":"createText"](text$$1);if(sel===Vnode.SEL_COMMENT)return vnode.el=api.createComment(text$$1);var _parseSel=parseSel(sel),tagName=_parseSel.tagName,id=_parseSel.id,className=_parseSel.className,el=api.createElement(tagName,parentNode);return id&&(el.id=id),className&&(el.className=className),vnode.el=el,array(children$$1)?addVnodes(el,children$$1,0,children$$1.length-1,insertedQueue):string(text$$1)&&api.append(el,api[raw?"createFragment":"createText"](text$$1)),data&&(data=[emptyNode,vnode],moduleEmitter.fire(HOOK_CREATE,data),execute(hook[HOOK_CREATE],NULL,data),hook[HOOK_INSERT]&&insertedQueue.push(vnode)),el},addVnodes=function(parentNode,vnodes,startIndex,endIndex,insertedQueue,before$$1){for(var i=startIndex;endIndex>=i;i++)addVnode(parentNode,vnodes[i],insertedQueue,before$$1)},addVnode=function(parentNode,vnode,insertedQueue,before$$1){api.before(parentNode,createElement$$1(parentNode,vnode,insertedQueue),before$$1)},removeVnodes=function(parentNode,vnodes,startIndex,endIndex){for(var i=startIndex;endIndex>=i;i++)removeVnode(parentNode,vnodes[i])},removeVnode=function(parentNode,vnode){var sel=vnode.sel,el=vnode.el,data=vnode.data;sel?(destroyVnode(vnode),api.remove(parentNode,el),data&&(moduleEmitter.fire(HOOK_REMOVE,vnode),data.hook&&execute(data.hook[HOOK_REMOVE],NULL,vnode))):api.remove(parentNode,el)},destroyVnode=function destroyVnode(vnode){var data=vnode.data,children$$1=vnode.children;data&&(children$$1&&each(children$$1,function(child){destroyVnode(child)}),moduleEmitter.fire(HOOK_DESTROY,vnode),data.hook&&execute(data.hook[HOOK_DESTROY],NULL,vnode))},replaceVnode=function(parentNode,oldVnode,vnode){parentNode&&(api.before(parentNode,vnode.el,oldVnode.el),removeVnode(parentNode,oldVnode))},updateChildren=function(parentNode,oldChildren,newChildren,insertedQueue){for(var oldStartIndex=0,oldEndIndex=oldChildren.length-1,oldStartVnode=oldChildren[oldStartIndex],oldEndVnode=oldChildren[oldEndIndex],newStartIndex=0,newEndIndex=newChildren.length-1,newStartVnode=newChildren[newStartIndex],newEndVnode=newChildren[newEndIndex],oldKeyToIndex=void 0,oldIndex=void 0,activeVnode=void 0;oldEndIndex>=oldStartIndex&&newEndIndex>=newStartIndex;)oldStartVnode?oldEndVnode?isSameVnode(oldStartVnode,newStartVnode)?(patchVnode(oldStartVnode,newStartVnode,insertedQueue),oldStartVnode=oldChildren[++oldStartIndex],newStartVnode=newChildren[++newStartIndex]):isSameVnode(oldEndVnode,newEndVnode)?(patchVnode(oldEndVnode,newEndVnode,insertedQueue),oldEndVnode=oldChildren[--oldEndIndex],newEndVnode=newChildren[--newEndIndex]):isSameVnode(oldStartVnode,newEndVnode)?(patchVnode(oldStartVnode,newEndVnode,insertedQueue),api.before(parentNode,oldStartVnode.el,api.next(oldEndVnode.el)),oldStartVnode=oldChildren[++oldStartIndex],newEndVnode=newChildren[--newEndIndex]):isSameVnode(oldEndVnode,newStartVnode)?(patchVnode(oldEndVnode,newStartVnode,insertedQueue),api.before(parentNode,oldEndVnode.el,oldStartVnode.el),oldEndVnode=oldChildren[--oldEndIndex],newStartVnode=newChildren[++newStartIndex]):(oldKeyToIndex||(oldKeyToIndex=createKeyToIndex(oldChildren,oldStartIndex,oldEndIndex)),oldIndex=oldKeyToIndex[newStartVnode.key],number(oldIndex)?(activeVnode=oldChildren[oldIndex],patchVnode(activeVnode,newStartVnode,insertedQueue),oldChildren[oldIndex]=NULL):(createElement$$1(parentNode,newStartVnode,insertedQueue),activeVnode=newStartVnode),api.before(parentNode,activeVnode.el,oldStartVnode.el),newStartVnode=newChildren[++newStartIndex]):oldEndVnode=oldChildren[--oldEndIndex]:oldStartVnode=oldChildren[++oldStartIndex];oldStartIndex>oldEndIndex?(activeVnode=newChildren[newEndIndex+1],addVnodes(parentNode,newChildren,newStartIndex,newEndIndex,insertedQueue,activeVnode?activeVnode.el:NULL)):newStartIndex>newEndIndex&&removeVnodes(parentNode,oldChildren,oldStartIndex,oldEndIndex)},patchVnode=function(oldVnode,vnode,insertedQueue){if(oldVnode!==vnode){var data=vnode.data,hook=data&&data.hook||{},args=[oldVnode,vnode];execute(hook[HOOK_PREPATCH],NULL,args);var el=vnode.el=oldVnode.el;vnode.payload=oldVnode.payload;var parentNode=api.parent(el);if(!isSameVnode(oldVnode,vnode))return createElement$$1(parentNode,vnode,insertedQueue),void replaceVnode(parentNode,oldVnode,vnode);data&&(moduleEmitter.fire(HOOK_UPDATE,args),execute(hook[HOOK_UPDATE],NULL,args));var newRaw=vnode.raw,newText=vnode.text,newChildren=vnode.children,oldRaw=oldVnode.raw,oldText=oldVnode.text,oldChildren=oldVnode.children;string(newText)?newText!==oldText&&(newRaw?api.replace(parentNode,api.createFragment(newText),el):api.text(el,newText)):newChildren&&oldChildren?newChildren!==oldChildren&&updateChildren(el,oldChildren,newChildren,insertedQueue):newChildren?(string(oldText)&&api[oldRaw?"html":"text"](el,CHAR_BLANK),addVnodes(el,newChildren,0,newChildren.length-1,insertedQueue)):oldChildren?removeVnodes(el,oldChildren,0,oldChildren.length-1):string(oldText)&&api[oldRaw?"html":"text"](el,CHAR_BLANK),execute(hook[HOOK_POSTPATCH],NULL,args)}};return function(oldVnode,vnode){moduleEmitter.fire(HOOK_PRE),api.isElement(oldVnode)&&(oldVnode=createVnode(oldVnode));var insertedQueue=[];if(isSameVnode(oldVnode,vnode))patchVnode(oldVnode,vnode,insertedQueue);else{var parentNode=api.parent(oldVnode.el);createElement$$1(parentNode,vnode,insertedQueue),replaceVnode(parentNode,oldVnode,vnode)}return each(insertedQueue,function(vnode){execute(vnode.data.hook[HOOK_INSERT],NULL,vnode)}),moduleEmitter.fire(HOOK_POST),vnode}}function updateStyle(oldVnode,vnode){var oldStyle=oldVnode.data.style,newStyle=vnode.data.style;if(oldStyle||newStyle){oldStyle=oldStyle||{},newStyle=newStyle||{};var style=vnode.el.style;each$1(newStyle,function(value,name){value!==oldStyle[name]&&(style[name]=value)}),each$1(oldStyle,function(value,name){has$1(newStyle,name)||(style[name]=CHAR_BLANK)})}}function updateAttrs(oldVnode,vnode){var oldAttrs=oldVnode.data.attrs,newAttrs=vnode.data.attrs;if(oldAttrs||newAttrs){oldAttrs=oldAttrs||{},newAttrs=newAttrs||{};var el=vnode.el;each$1(newAttrs,function(value,name){value!==oldAttrs[name]&&(!value&&booleanMap[name]?el.removeAttribute(name):el.setAttribute(name,value))}),each$1(oldAttrs,function(value,name){has$1(newAttrs,name)||el.removeAttribute(name)})}}function addInputListener(element,listener){listener.$listener=function(e){"value"===e.propertyName&&(e=new Event(e),e.type=inputType,listener.call(this,e))},on$1(element,propertychangeType,listener.$listener)}function removeInputListener(element,listener){off$1(element,propertychangeType,listener.$listener),delete listener.$listener}function addChangeListener(element,listener){listener.$listener=function(e){e=new Event(e),e.type=changeType,listener.call(this,e)},on$1(element,clickType,listener.$listener)}function removeChangeListener(element,listener){off$1(element,clickType,listener.$listener),delete listener.$listener}function isBox(element){return"INPUT"===element.tagName||"radio"===element.type||"checkbox"===element.type}function on$1(element,type,listener){type===inputType?addInputListener(element,listener):type===changeType&&isBox(element)?addChangeListener(element,listener):element.attachEvent("on"+type,listener)}function off$1(element,type,listener){type===inputType?removeInputListener(element,listener):type===changeType&&isBox(element)?removeChangeListener(element,listener):element.detachEvent("on"+type,listener)}function createEvent$1(event,element){return new IEEvent(event,element)}function create(ast,context,instance){var createComment=function(){return h(Vnode.SEL_COMMENT)},createText=function(node){var safe=node.safe,content=node.content;return safe===FALSE&&string(content)&&tag.test(content)?new Vnode({text:content,raw:TRUE}):content
},createElement=function(node,isComponent){var hooks={},attributes$$1={},directives={},styles=void 0,component=void 0,data={hook:hooks};return isComponent||each(node.attributes,function(node){var name=node.name,value=node.value;if("style"===name){var list=parse(value,CHAR_SEMCOL,CHAR_COLON);list.length&&(styles={},each(list,function(item){item.value&&(styles[camelCase(item.key)]=item.value)}))}else{attributes$$1[name]=node;var attrs=data.attrs||(data.attrs={});attrs[name]=value}}),each(node.directives,function(node){var name=node.name,modifier=node.modifier;name===KEYWORD_UNIQUE?data.key=node.value:(name=modifier?""+name+CHAR_DOT+modifier:name,directives[name]||(directives[name]=node))}),styles&&(data.style=styles),hooks.insert=hooks.postpatch=hooks.destroy=function(oldVnode,vnode){var nextVnode=vnode||oldVnode,payload=oldVnode.payload||(oldVnode.payload={}),destroies=payload.destroies||(payload.destroies={}),oldComponent=payload.component,oldDirectives=payload.directives;oldComponent?(component=oldComponent,object(component)&&component.set(toObject(node.attributes,"name","value"),TRUE)):isComponent&&(component=payload.component=[],instance.component(node.name,function(options){array(component)&&(oldComponent=component,component=payload.component=instance.create(options,{el:nextVnode.el,props:toObject(node.attributes,"name","value"),replace:TRUE}),each(oldComponent,function(callback){callback(component)}))}));var bind=function(key){var node=directives[key];return execute(instance.directive(node.name),NULL,{el:nextVnode.el,node:node,instance:instance,directives:directives,attributes:attributes$$1,component:component})};each$1(directives,function(directive,key){if(vnode&&oldDirectives){var oldDirective=oldDirectives[key];if(oldDirective)return void(oldDirective.value!==directive.value&&(destroies[key]&&destroies[key](),destroies[key]=bind(key)))}destroies[key]=bind(key)}),oldDirectives&&each$1(oldDirectives,function(oldDirective,key){!destroies[key]||vnode&&directives[key]||(destroies[key](),delete destroies[key])}),payload.attributes=attributes$$1,payload.directives=directives,hooks.insert=hooks.postpatch=hooks.destroy=noop},h(isComponent?"div":node.name,data,node.children.map(function(child){return child instanceof Vnode?child:toString$2(child)}))},importTemplate=function(name){return instance.partial(name)};return render(ast,createComment,createText,createElement,importTemplate,context)}function create$1(tagName,parentNode){return parentNode?(api.html(parentNode,"<"+tagName+"></"+tagName+">"),api.children(parentNode)[0]):api.createElement(tagName)}function getContent(selector){return api.find(selector).innerHTML}function on$2(element,type,listener,context){var $emitter=element.$emitter||(element.$emitter=new Emitter);if(!$emitter.has(type)){var nativeListener=function(e){e instanceof Event||(e=new Event(api.createEvent(e,element))),$emitter.fire(e.type,e,context)};$emitter[type]=nativeListener,api.on(element,type,nativeListener)}$emitter.on(type,listener)}function off$2(element,type,listener){var $emitter=element.$emitter,types=keys($emitter.listeners);$emitter.off(type,listener),each(types,function(type){$emitter[type]&&!$emitter.has(type)&&(api.off(element,type,$emitter[type]),delete $emitter[type])})}function parseRegisterArguments(type,args){var id=args[0],value=args[1],callback=void 0;return has(supportRegisterAsync,type)&&func(value)&&(callback=value,value=UNDEFINED),{callback:callback,args:value===UNDEFINED?[id]:[id,value]}}function updateDeps(instance,newDeps,oldDeps,watcher){oldDeps=oldDeps||[],each(newDeps,function(dep){has(oldDeps,dep)||instance.watch(dep,watcher)}),each(oldDeps,function(dep){has(newDeps,dep)||instance.unwatch(dep,watcher)})}function diff(instance){var $children=instance.$children,$watchCache=instance.$watchCache,$watchEmitter=instance.$watchEmitter,$computedDeps=instance.$computedDeps,keys$$1=[],addKey=function(key,push$$1){has(keys$$1,key)||(push$$1?keys$$1.push(key):keys$$1.unshift(key))},pickDeps=function pickDeps(key){$computedDeps&&!falsy($computedDeps[key])?(each($computedDeps[key],pickDeps),addKey(key,TRUE)):addKey(key)};each$1($watchCache,function(value,key){pickDeps(key)}),each(keys$$1,function(key){var oldValue=$watchCache[key],newValue=instance.get(key);newValue!==oldValue&&($watchCache[key]=newValue,$watchEmitter.fire(key,[newValue,oldValue,key],instance))});var $dirty=instance.$dirty,$dirtyIgnore=instance.$dirtyIgnore;return $dirty&&delete instance.$dirty,$dirtyIgnore?void delete instance.$dirtyIgnore:void($dirty?instance.updateView():$children&&each($children,function(child){diff(child)}))}Object.keys=function(obj){var result=[];for(var key in obj)push(result,key);return result},Object.freeze=function(obj){return obj},Object.defineProperty=function(obj,key,descriptor){obj[key]=descriptor.value},Object.create=function(proto){function Class(){}return Class.prototype=proto,new Class},String.prototype.trim=function(){return this.replace(/^\s*|\s*$/g,"")},Array.prototype.indexOf=function(target){var result=-1;return each(this,function(item,index){return item===target?(result=index,FALSE):void 0}),result},Array.prototype.map=function(fn){var result=[];return each(this,function(item,index){result.push(fn(item,index))}),result},Array.prototype.filter=function(fn){var result=[];return each(this,function(item,index){fn(item,index)&&result.push(item)}),result},Function.prototype.bind=function(context){var fn=this;return function(){return execute(fn,context,toArray(arguments))}};var TRUE=!0,FALSE=!1,NULL=null,UNDEFINED=void 0,win="undefined"!=typeof window?window:NULL,doc="undefined"!=typeof document?document:NULL,noop=function(){},toString=Object.prototype.toString,is$1=Object.freeze({is:is,func:func,array:array,object:object,string:string,number:number,"boolean":boolean,primitive:primitive,numeric:numeric}),execute=function(fn,context,args){return func(fn)?array(args)?fn.apply(context,args):fn.call(context,args):void 0},slice=Array.prototype.slice,push=add("push"),unshift=add("unshift"),array$1=Object.freeze({each:each,merge:merge,push:push,unshift:unshift,toArray:toArray,toObject:toObject,indexOf:indexOf,has:has,last:last,remove:remove,falsy:falsy}),magic=function(options){var args=options.args,get=options.get,set=options.set;args=toArray(args);{var key=args[0];args[1]}if(object(key))execute(set,NULL,key);else if(string(key)){var _args=args,length=_args.length;if(2===length)execute(set,NULL,args);else if(1===length)return execute(get,NULL,key)}},toNumber=function(str){var defaultValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return numeric(str)?+str:defaultValue},CHAR_BLANK="",CHAR_ASTERISK="*",CHAR_DOT=".",CODE_DOT=codeAt(CHAR_DOT),CHAR_HASH="#",CHAR_DASH=(codeAt(CHAR_HASH),"-"),CHAR_EQUAL=(codeAt(CHAR_DASH),"="),CODE_EQUAL=codeAt(CHAR_EQUAL),CHAR_SLASH="/",CODE_SLASH=codeAt(CHAR_SLASH),CHAR_COMMA=",",CODE_COMMA=codeAt(CHAR_COMMA),CHAR_COLON=":",CODE_COLON=codeAt(CHAR_COLON),CHAR_SEMCOL=";",CHAR_SQUOTE=(codeAt(CHAR_SEMCOL),"'"),CODE_SQUOTE=codeAt(CHAR_SQUOTE),CHAR_DQUOTE='"',CODE_DQUOTE=codeAt(CHAR_DQUOTE),CHAR_OPAREN="(",CODE_OPAREN=codeAt(CHAR_OPAREN),CHAR_CPAREN=")",CODE_CPAREN=codeAt(CHAR_CPAREN),CHAR_OBRACK="[",CODE_OBRACK=codeAt(CHAR_OBRACK),CHAR_CBRACK="]",CODE_CBRACK=codeAt(CHAR_CBRACK),CHAR_OBRACE="{",CHAR_CBRACE=(codeAt(CHAR_OBRACE),"}"),CHAR_LEFT=(codeAt(CHAR_CBRACE),"<"),CODE_LEFT=codeAt(CHAR_LEFT),CHAR_RIGHT=">",CODE_RIGHT=codeAt(CHAR_RIGHT),CHAR_QUMARK="?",CODE_QUMARK=codeAt(CHAR_QUMARK),CHAR_TAB="	",CODE_TAB=codeAt(CHAR_TAB),CHAR_BREAKLINE="\n",CHAR_WHITESPACE=(codeAt(CHAR_BREAKLINE)," "),CODE_WHITESPACE=codeAt(CHAR_WHITESPACE),string$1=Object.freeze({camelCase:camelCase,capitalize:capitalize,falsy:falsy$1,parse:parse,trim:trim,slice:slice$1,split:split,indexOf:indexOf$1,has:has$2,startsWith:startsWith,endsWith:endsWith}),SEPARATOR_KEY=CHAR_DOT,SEPARATOR_PATH=CHAR_SLASH,LEVEL_CURRENT=CHAR_DOT,LEVEL_PARENT=""+CHAR_DOT+CHAR_DOT,object$1=Object.freeze({keys:keys,each:each$1,has:has$1,extend:extend,copy:copy,get:get,set:set}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),inherits=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)},possibleConstructorReturn=function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},Store=function(){function Store(){classCallCheck(this,Store),this.data={}}return createClass(Store,[{key:"get",value:function(key){return this.data[key]}},{key:"getAsync",value:function(key,callback){var data=this.data,value=data[key];func(value)?!function(){var $pending=value.$pending;$pending?push($pending,callback):($pending=value.$pending=[callback],value(function(replacement){delete value.$pending,data[key]=replacement,each($pending,function(callback){callback(replacement)})}))}():callback(value)}},{key:"set",value:function(key,value){var data=this.data;object(key)?each$1(key,function(value,key){data[key]=value}):string(key)&&(data[key]=value)}}]),Store}(),Event=function(){function Event(event){classCallCheck(this,Event),event.type?(this.type=event.type,this.originalEvent=event):this.type=event}return createClass(Event,[{key:"prevent",value:function(){if(!this.isPrevented){var originalEvent=this.originalEvent;originalEvent&&func(originalEvent.preventDefault)&&originalEvent.preventDefault(),this.isPrevented=TRUE}}},{key:"stop",value:function(){if(!this.isStoped){var originalEvent=this.originalEvent;originalEvent&&func(originalEvent.stopPropagation)&&originalEvent.stopPropagation(),this.isStoped=TRUE}}}]),Event}(),Emitter=function(){function Emitter(options){classCallCheck(this,Emitter),extend(this,options),this.listeners={}}return createClass(Emitter,[{key:"on",value:function(type,listener){var listeners=this.listeners,afterAdd=this.afterAdd,added=[],addListener=function(listener,type){if(func(listener)){var list=listeners[type]||(listeners[type]=[]);list.length||push(added,type),push(list,listener)}};object(type)?each$1(type,addListener):string(type)&&addListener(listener,type),added.length&&func(afterAdd)&&afterAdd(added)}},{key:"once",value:function(type,listener){var instance=this,addOnce=function(listener,type){func(listener)&&(listener.$once=function(){instance.off(type,listener),delete listener.$once})};object(type)?each$1(type,addOnce):string(type)&&addOnce(listener,type),instance.on(type,listener)}},{key:"off",value:function(type,listener){var listeners=this.listeners,afterRemove=this.afterRemove,removed=[];if(type==NULL)each$1(listeners,function(list,type){array(listeners[type])&&(listeners[type].length=0,push(removed,type))});else{var list=listeners[type];array(list)&&(listener==NULL?list.length=0:remove(list,listener),list.length||push(removed,type))}removed.length&&func(afterRemove)&&afterRemove(removed)}},{key:"fire",value:function(type,data,context){2===arguments.length&&(context=NULL);var done=TRUE,handle=function(list,data){array(list)&&each(list,function(listener){var result=execute(listener,context,data),$once=listener.$once;return func($once)&&$once(),data instanceof Event&&(result===FALSE?(data.prevent(),data.stop()):data.isStoped&&(result=FALSE)),result===FALSE?done=FALSE:void 0})},listeners=this.listeners;return handle(listeners[type],data),done&&each$1(listeners,function(list,key){if(key!==type||has$2(key,CHAR_ASTERISK)){key=["^",key.replace(/\./g,"\\.").replace(/\*\*/g,"([.\\w]+?)").replace(/\*/g,"(\\w+)"),endsWith(key,""+CHAR_ASTERISK+CHAR_ASTERISK)?CHAR_BLANK:"$"];var match=type.match(new RegExp(key.join(CHAR_BLANK)));return match&&handle(list,merge(data,toArray(match).slice(1))),done}}),done}},{key:"has",value:function(type,listener){var list=this.listeners[type];return listener==NULL?!falsy(list):array(list)?has(list,listener):FALSE}}]),Emitter}(),hasConsole="undefined"!=typeof console,debug=/yox/.test(noop.toString()),nextTick=void 0;nextTick="function"==typeof MutationObserver?function(fn){var activeElement=doc.activeElement;if(activeElement&&"oninput"in activeElement)setTimeout(fn);else{var observer=new MutationObserver(fn),textNode=doc.createTextNode(CHAR_BLANK);observer.observe(textNode,{characterData:TRUE}),textNode.data=CHAR_WHITESPACE}}:"function"==typeof setImmediate?setImmediate:setTimeout;var nextTick$1=nextTick,nextTasks=[],ARRAY=1,BINARY=2,CALL=3,CONDITIONAL=4,IDENTIFIER=5,LITERAL=6,MEMBER=7,UNARY=8,PLUS="+",MINUS="-",MULTIPLY="*",DIVIDE="/",MODULO="%",WAVE="~",AND="&&",OR="||",NOT="!",BOOLEAN="!!",SE="===",SNE="!==",LE="==",LNE="!=",LT="<",LTE="<=",GT=">",GTE=">=",unaryMap={};unaryMap[PLUS]=unaryMap[MINUS]=unaryMap[NOT]=unaryMap[WAVE]=unaryMap[BOOLEAN]=TRUE;var unaryList=sortKeys(unaryMap),binaryMap={};binaryMap[OR]=1,binaryMap[AND]=2,binaryMap[LE]=binaryMap[LNE]=binaryMap[SE]=binaryMap[SNE]=3,binaryMap[LT]=binaryMap[LTE]=binaryMap[GT]=binaryMap[GTE]=4,binaryMap[PLUS]=binaryMap[MINUS]=5,binaryMap[MULTIPLY]=binaryMap[DIVIDE]=binaryMap[MODULO]=6;var binaryList=sortKeys(binaryMap),Node=function Node(type){classCallCheck(this,Node),this.type=type},Array$1=function(_Node){function Array(elements){classCallCheck(this,Array);var _this=possibleConstructorReturn(this,(Array.__proto__||Object.getPrototypeOf(Array)).call(this,ARRAY));return _this.elements=elements,_this}return inherits(Array,_Node),Array}(Node),Binary=function(_Node){function Binary(left,operator,right){classCallCheck(this,Binary);var _this=possibleConstructorReturn(this,(Binary.__proto__||Object.getPrototypeOf(Binary)).call(this,BINARY));return _this.left=left,_this.operator=operator,_this.right=right,_this}return inherits(Binary,_Node),Binary}(Node);Binary[OR]=function(a,b){return a||b},Binary[AND]=function(a,b){return a&&b},Binary[SE]=function(a,b){return a===b},Binary[SNE]=function(a,b){return a!==b},Binary[LE]=function(a,b){return a==b},Binary[LNE]=function(a,b){return a!=b},Binary[LT]=function(a,b){return b>a},Binary[LTE]=function(a,b){return b>=a},Binary[GT]=function(a,b){return a>b},Binary[GTE]=function(a,b){return a>=b},Binary[PLUS]=function(a,b){return a+b},Binary[MINUS]=function(a,b){return a-b},Binary[MULTIPLY]=function(a,b){return a*b},Binary[DIVIDE]=function(a,b){return a/b},Binary[MODULO]=function(a,b){return a%b};var Call=function(_Node){function Call(callee,args){classCallCheck(this,Call);var _this=possibleConstructorReturn(this,(Call.__proto__||Object.getPrototypeOf(Call)).call(this,CALL));return _this.callee=callee,_this.args=args,_this}return inherits(Call,_Node),Call}(Node),Conditional=function(_Node){function Conditional(test,consequent,alternate){classCallCheck(this,Conditional);var _this=possibleConstructorReturn(this,(Conditional.__proto__||Object.getPrototypeOf(Conditional)).call(this,CONDITIONAL));return _this.test=test,_this.consequent=consequent,_this.alternate=alternate,_this}return inherits(Conditional,_Node),Conditional}(Node),Identifier=function(_Node){function Identifier(name){classCallCheck(this,Identifier);var _this=possibleConstructorReturn(this,(Identifier.__proto__||Object.getPrototypeOf(Identifier)).call(this,IDENTIFIER));return _this.name=name,_this}return inherits(Identifier,_Node),Identifier}(Node),Literal=function(_Node){function Literal(value,raw){classCallCheck(this,Literal);var _this=possibleConstructorReturn(this,(Literal.__proto__||Object.getPrototypeOf(Literal)).call(this,LITERAL));return _this.value=value,raw&&(_this.raw=raw),_this}return inherits(Literal,_Node),Literal}(Node),Member=function(_Node){function Member(object,prop){classCallCheck(this,Member);var _this=possibleConstructorReturn(this,(Member.__proto__||Object.getPrototypeOf(Member)).call(this,MEMBER));return _this.object=object,_this.prop=prop,_this}return inherits(Member,_Node),Member}(Node),Unary=function(_Node){function Unary(operator,arg){classCallCheck(this,Unary);var _this=possibleConstructorReturn(this,(Unary.__proto__||Object.getPrototypeOf(Unary)).call(this,UNARY));return _this.operator=operator,_this.arg=arg,_this}return inherits(Unary,_Node),Unary}(Node);Unary[PLUS]=function(value){return+value},Unary[MINUS]=function(value){return-value},Unary[NOT]=function(value){return!value},Unary[WAVE]=function(value){return~value},Unary[BOOLEAN]=function(value){return!!value};var keywords={};keywords["true"]=TRUE,keywords["false"]=FALSE,keywords["null"]=NULL,keywords.undefined=UNDEFINED;var compileCache$1={},IF="#if",ELSE="else",ELSE_IF="else if",EACH="#each",PARTIAL="#partial",IMPORT=">",COMMENT=":",SPREAD="...",SPECIAL_EVENT="$event",SPECIAL_KEYPATH="$keypath",DIRECTIVE_CUSTOM_PREFIX="o-",DIRECTIVE_EVENT_PREFIX="on-",DIRECTIVE_REF="ref",DIRECTIVE_LAZY="lazy",DIRECTIVE_MODEL="model",KEYWORD_UNIQUE="key",DELIMITER_OPENING="(?:\\{)?\\{\\{\\s*",DELIMITER_CLOSING="\\s*\\}\\}(?:\\})?",IF$1=1,ELSE_IF$1=2,ELSE$1=3,EACH$1=4,PARTIAL$1=5,IMPORT$1=6,EXPRESSION=7,SPREAD$1=8,DIRECTIVE=9,ELEMENT=10,ATTRIBUTE=11,TEXT=12,Context=function(){function Context(data,parent){classCallCheck(this,Context),this.data=copy(data),this.parent=parent,this.cache={}}return createClass(Context,[{key:"push",value:function(data){return new Context(data,this)}},{key:"pop",value:function(){return this.parent}},{key:"format",value:function(keypath){var instance=this,keys$$1=parse$1(keypath);if("this"===keys$$1[0])return keys$$1.shift(),{keypath:stringify(keys$$1),instance:instance};var _ret=function(){var lookup=TRUE,index=0,levelMap={};return levelMap[LEVEL_CURRENT]=FALSE,levelMap[LEVEL_PARENT]=TRUE,each(keys$$1,function(key,i){return has$1(levelMap,key)?(lookup=FALSE,levelMap[key]&&(instance=instance.parent,!instance)?FALSE:void 0):(index=i,FALSE)}),{v:{keypath:stringify(keys$$1.slice(index)),instance:instance,lookup:lookup}}}();return"object"===("undefined"==typeof _ret?"undefined":_typeof(_ret))?_ret.v:void 0}},{key:"set",value:function(key,value){var _format=this.format(key),instance=_format.instance,keypath=_format.keypath;instance&&keypath&&(has$1(instance.cache,keypath)&&delete instance.cache[keypath],set(instance.data,keypath,value))}},{key:"get",value:function(key){var _format2=this.format(key),instance=_format2.instance,keypath=_format2.keypath,lookup=_format2.lookup;if(instance){var _instance=instance,data=_instance.data,cache=_instance.cache;if(!has$1(cache,keypath))if(keypath){var result=void 0;if(lookup){for(var keys$$1=[keypath];instance&&!(result=get(instance.data,keypath));)instance=instance.parent,unshift(keys$$1,LEVEL_PARENT);keypath=keys$$1.join(SEPARATOR_PATH)}else result=get(data,keypath);result&&(cache[keypath]=result.value)}else cache[keypath]=data;if(has$1(cache,keypath))return{keypath:keypath,value:cache[keypath]}}return warn('Failed to lookup "'+key+'" data.'),{keypath:key}}}]),Context}(),Scanner=function(){function Scanner(str){classCallCheck(this,Scanner),this.init(str)}return createClass(Scanner,[{key:"init",value:function(str){this.pos=0,this.tail=str}},{key:"hasNext",value:function(){return this.tail}},{key:"nextAfter",value:function(pattern){var tail=this.tail,matches=tail.match(pattern);if(!matches||matches.index)return CHAR_BLANK;var result=matches[0];return this.forward(result.length),result}},{key:"nextBefore",value:function(pattern){var tail=(this.pos,this.tail),matches=tail.match(pattern);if(matches){var index=matches.index;if(!index)return CHAR_BLANK;var result=tail.substr(0,index);return this.forward(index),result}return this.forward(tail.length),tail}},{key:"forward",value:function(offset){this.pos+=offset,this.tail=slice$1(this.tail,offset)}},{key:"charAt",value:function(index){return charAt(this.tail,index)}},{key:"codeAt",value:function(index){return codeAt(this.tail,index)}}]),Scanner}(),Node$2=function(){function Node(type){classCallCheck(this,Node),this.type=type}return createClass(Node,[{key:"addChild",value:function(child){push(this.children||(this.children=[]),child)}}]),Node}(),Attribute=function(_Node){function Attribute(name){classCallCheck(this,Attribute);var _this=possibleConstructorReturn(this,(Attribute.__proto__||Object.getPrototypeOf(Attribute)).call(this,ATTRIBUTE));return _this.name=name,_this}return inherits(Attribute,_Node),Attribute}(Node$2),Directive=function(_Node){function Directive(name,modifier){classCallCheck(this,Directive);var _this=possibleConstructorReturn(this,(Directive.__proto__||Object.getPrototypeOf(Directive)).call(this,DIRECTIVE));return _this.name=name,modifier&&(_this.modifier=modifier),_this}return inherits(Directive,_Node),Directive}(Node$2),Each=function(_Node){function Each(expr,index){classCallCheck(this,Each);var _this=possibleConstructorReturn(this,(Each.__proto__||Object.getPrototypeOf(Each)).call(this,EACH$1));return _this.expr=expr,index&&(_this.index=index),_this}return inherits(Each,_Node),Each}(Node$2),Element=function(_Node){function Element(name,component){classCallCheck(this,Element);var _this=possibleConstructorReturn(this,(Element.__proto__||Object.getPrototypeOf(Element)).call(this,ELEMENT));return _this.name=name,component&&(_this.component=component),_this}return inherits(Element,_Node),createClass(Element,[{key:"addAttr",value:function(child){push(this.attrs||(this.attrs=[]),child)}}]),Element}(Node$2),Else=function(_Node){function Else(){return classCallCheck(this,Else),possibleConstructorReturn(this,(Else.__proto__||Object.getPrototypeOf(Else)).call(this,ELSE$1))}return inherits(Else,_Node),Else}(Node$2),ElseIf=function(_Node){function ElseIf(expr){classCallCheck(this,ElseIf);var _this=possibleConstructorReturn(this,(ElseIf.__proto__||Object.getPrototypeOf(ElseIf)).call(this,ELSE_IF$1));return _this.expr=expr,_this}return inherits(ElseIf,_Node),ElseIf}(Node$2),Expression=function(_Node){function Expression(expr,safe){classCallCheck(this,Expression);var _this=possibleConstructorReturn(this,(Expression.__proto__||Object.getPrototypeOf(Expression)).call(this,EXPRESSION));return _this.expr=expr,_this.safe=safe,_this}return inherits(Expression,_Node),Expression}(Node$2),If=function(_Node){function If(expr){classCallCheck(this,If);var _this=possibleConstructorReturn(this,(If.__proto__||Object.getPrototypeOf(If)).call(this,IF$1));return _this.expr=expr,_this}return inherits(If,_Node),If}(Node$2),Import=function(_Node){function Import(name){classCallCheck(this,Import);var _this=possibleConstructorReturn(this,(Import.__proto__||Object.getPrototypeOf(Import)).call(this,IMPORT$1));return _this.name=name,_this}return inherits(Import,_Node),Import}(Node$2),Partial=function(_Node){function Partial(name){classCallCheck(this,Partial);var _this=possibleConstructorReturn(this,(Partial.__proto__||Object.getPrototypeOf(Partial)).call(this,PARTIAL$1));return _this.name=name,_this}return inherits(Partial,_Node),Partial}(Node$2),Spread=function(_Node){function Spread(expr){classCallCheck(this,Spread);var _this=possibleConstructorReturn(this,(Spread.__proto__||Object.getPrototypeOf(Spread)).call(this,SPREAD$1));return _this.expr=expr,_this}return inherits(Spread,_Node),Spread}(Node$2),Text=function(_Node){function Text(content){classCallCheck(this,Text);var _this=possibleConstructorReturn(this,(Text.__proto__||Object.getPrototypeOf(Text)).call(this,TEXT));return _this.content=content,_this}return inherits(Text,_Node),Text}(Node$2),openingDelimiterPattern=new RegExp(DELIMITER_OPENING),closingDelimiterPattern=new RegExp(DELIMITER_CLOSING),openingTagPattern=/<(?:\/)?[-a-z]\w*/i,closingTagPattern=/(?:\/)?>/,attributePattern=/([-:@a-z0-9]+)(?==["'])?/i,componentNamePattern=/[-A-Z]/,selfClosingTagNamePattern=/input|img|br/i,toString$1=Function.prototype.toString,ifTypes={};ifTypes[IF$1]=ifTypes[ELSE_IF$1]=TRUE;var elseTypes={};elseTypes[ELSE_IF$1]=elseTypes[ELSE$1]=TRUE;var attrTypes={};attrTypes[ATTRIBUTE]=attrTypes[DIRECTIVE]=TRUE;var leafTypes={};leafTypes[EXPRESSION]=leafTypes[IMPORT$1]=leafTypes[SPREAD$1]=leafTypes[TEXT]=TRUE;var buildInDirectives={};buildInDirectives[DIRECTIVE_REF]=buildInDirectives[DIRECTIVE_LAZY]=buildInDirectives[DIRECTIVE_MODEL]=buildInDirectives[KEYWORD_UNIQUE]=TRUE;var compileCache={},parsers=[{test:function(source){return startsWith(source,EACH)},create:function(source,terms){return terms=split(slicePrefix(source,EACH),CHAR_COLON),terms[0]?new Each(compile$1(terms[0]),terms[1]):void 0}},{test:function(source){return startsWith(source,IMPORT)},create:function(source){return source=slicePrefix(source,IMPORT),source?new Import(source):void 0}},{test:function(source){return startsWith(source,PARTIAL)},create:function(source){return source=slicePrefix(source,PARTIAL),source?new Partial(source):void 0}},{test:function(source){return startsWith(source,IF)},create:function(source){return source=slicePrefix(source,IF),source?new If(compile$1(source)):void 0}},{test:function(source){return startsWith(source,ELSE_IF)},create:function(source){return source=slicePrefix(source,ELSE_IF),source?new ElseIf(compile$1(source)):void 0}},{test:function(source){return startsWith(source,ELSE)},create:function(){return new Else}},{test:function(source){return startsWith(source,SPREAD)},create:function(source){return source=slicePrefix(source,SPREAD),source?new Spread(compile$1(source)):void 0}},{test:function(source){return!startsWith(source,COMMENT)},create:function(source,delimiter){return source=trim(source),source?new Expression(compile$1(source),!endsWith(delimiter,"}}}")):void 0}}],tag=/<[^>]+>/,selector=/^[#.]\w+$/,BEFORE_CREATE="beforeCreate",AFTER_CREATE="afterCreate",BEFORE_MOUNT="beforeMount",AFTER_MOUNT="afterMount",BEFORE_UPDATE="beforeUpdate",AFTER_UPDATE="afterUpdate",BEFORE_DESTROY="beforeDestroy",AFTER_DESTROY="afterDestroy",Vnode=function Vnode(options){classCallCheck(this,Vnode),extend(this,options)};Vnode.SEL_COMMENT="!";var SVGElement=win.SVGElement,api=Object.freeze({createElement:createElement,createFragment:createFragment,createText:createText,createComment:createComment,createEvent:createEvent,isElement:isElement,isFragment:isFragment,before:before,replace:replace,remove:remove$1,append:append,parent:parent,next:next,tag:tag$1,children:children,text:text,html:html,find:find,on:on,off:off}),HOOK_INIT="init",HOOK_CREATE="create",HOOK_INSERT="insert",HOOK_REMOVE="remove",HOOK_DESTROY="destroy",HOOK_PRE="pre",HOOK_POST="post",HOOK_PREPATCH="prepatch",HOOK_UPDATE="update",HOOK_POSTPATCH="postpatch",moduleHooks=[HOOK_CREATE,HOOK_UPDATE,HOOK_REMOVE,HOOK_DESTROY,HOOK_PRE,HOOK_POST],emptyNode=new Vnode({sel:CHAR_BLANK,data:{},children:[]}),h=function(sel,data){var children=void 0,text=void 0,lastArg=last(arguments);return array(lastArg)?(children=lastArg,each(children,function(child,i){child instanceof Vnode||(children[i]=new Vnode({text:child}))})):string(lastArg)&&(text=lastArg),new Vnode({sel:sel,text:text,children:children,data:object(data)?data:{}})},style={create:updateStyle,update:updateStyle},booleanLiteral="allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declaredefault,defaultchecked,defaultmuted,defaultselected,defer,disabled,draggableenabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiplemuted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonlyrequired,reversed,scoped,seamless,selected,sortable,spellcheck,translatetruespeed,typemustmatch,visible",booleanMap=toObject(split(booleanLiteral,CHAR_COMMA)),attributes={create:updateAttrs,update:updateAttrs},toString$2=function(str){var defaultValue=arguments.length>1&&void 0!==arguments[1]?arguments[1]:CHAR_BLANK;try{return str.toString()}catch(e){return defaultValue}},clickType="click",inputType="input",changeType="change",propertychangeType="propertychange",IEEvent=function(){function IEEvent(event,element){classCallCheck(this,IEEvent),extend(this,event),this.currentTarget=element,this.target=event.srcElement||element,this.originalEvent=event}return createClass(IEEvent,[{key:"preventDefault",value:function(){this.originalEvent.returnValue=FALSE}},{key:"stopPropagation",value:function(){this.originalEvent.cancelBubble=TRUE}}]),IEEvent}(),oldApi=Object.freeze({on:on$1,off:off$1,createEvent:createEvent$1});doc.addEventListener||extend(api,oldApi);var patch=init([attributes,style],api),find$1=api.find,isElement$1=api.isElement,native=Object.freeze({find:find$1,isElement:isElement$1,create:create$1,getContent:getContent,on:on$2,off:off$2}),ref=function(_ref){var el=_ref.el,node=_ref.node,instance=_ref.instance,component=_ref.component,value=node.value;if(!falsy$1(value)){var $refs=instance.$refs;object($refs)?has$1($refs,value)&&error$1('Passing a ref "'+value+'" is existed.'):$refs=instance.$refs={};var set$$1=function(target){$refs[value]=target};return component?array(component)?push(component,set$$1):set$$1(component):set$$1(el),function(){has$1($refs,value)?delete $refs[value]:array(component)&&remove(component,set$$1)}}},debounce=function(fn,delay,immediate){var timer=void 0;return function(){var _arguments=arguments;timer||!function(){var args=toArray(_arguments);immediate&&execute(fn,NULL,args),timer=setTimeout(function(){timer=NULL,immediate||execute(fn,NULL,args)},delay)}()}},immediateTypes=["click","tap"],event=function(_ref){var el=_ref.el,node=_ref.node,instance=_ref.instance,component=_ref.component,directives=_ref.directives,type=_ref.type,listener=_ref.listener;if(type||(type=node.modifier),listener||(listener=instance.compileValue(node.keypath,node.value)),type&&listener){var lazy=directives.lazy;if(lazy&&(numeric(lazy.value)&&lazy.value>=0?listener=debounce(listener,lazy.value,has(immediateTypes,type)):"input"===type&&(type="change")),!component)return on$2(el,type,listener),function(){off$2(el,type,listener)};var _ret=function(){var bind=function(component){component.on(type,listener)};return array(component)?push(component,bind):bind(component),{v:function(){component.off(type,listener),array(component)&&remove(component,bind)}}}();if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}},inputControl={set:function(_ref){var el=_ref.el,keypath=_ref.keypath,instance=_ref.instance,value=toString$2(instance.get(keypath));value!==el.value&&(el.value=value)},sync:function(_ref2){var el=_ref2.el,keypath=_ref2.keypath,instance=_ref2.instance;instance.set(keypath,el.value)}},selectControl={set:function(_ref3){var el=_ref3.el,keypath=_ref3.keypath,instance=_ref3.instance,value=toString$2(instance.get(keypath)),options=el.options,selectedIndex=el.selectedIndex;value!==options[selectedIndex].value&&each(options,function(option,index){return options.value===value?(el.selectedIndex=index,FALSE):void 0})},sync:function(_ref4){var el=_ref4.el,keypath=_ref4.keypath,instance=_ref4.instance,value=el.options[el.selectedIndex].value;instance.set(keypath,value)}},radioControl={set:function(_ref5){var el=_ref5.el,keypath=_ref5.keypath,instance=_ref5.instance;el.checked=el.value===toString$2(instance.get(keypath))},sync:function(_ref6){var el=_ref6.el,keypath=_ref6.keypath,instance=_ref6.instance;el.checked&&instance.set(keypath,el.value)
}},checkboxControl={set:function(_ref7){var el=_ref7.el,keypath=_ref7.keypath,instance=_ref7.instance,value=instance.get(keypath);el.checked=array(value)?has(value,el.value,FALSE):boolean(value)?value:!!value},sync:function(_ref8){var el=_ref8.el,keypath=_ref8.keypath,instance=_ref8.instance,value=instance.get(keypath);array(value)?(el.checked?push(value,el.value):remove(value,el.value,FALSE),instance.set(keypath,copy(value))):instance.set(keypath,el.checked)}},specialControls={radio:radioControl,checkbox:checkboxControl,SELECT:selectControl},model=function(_ref9){var el=_ref9.el,node=_ref9.node,instance=_ref9.instance,directives=_ref9.directives,attributes=_ref9.attributes,value=node.value,keypath=node.keypath,result=instance.get(value,keypath);if(!result)return void error$1("The "+keypath+" being used for two-way binding is ambiguous.");keypath=result.keypath;var type="change",tagName=el.tagName,controlType=el.type,control=specialControls[controlType]||specialControls[tagName];control||(control=inputControl,("oninput"in el||"TEXTAREA"===tagName||"text"===controlType||"password"===controlType)&&(type="input"));var data={el:el,keypath:keypath,instance:instance},set$$1=function(){control.set(data)};return has$1(attributes,"value")||set$$1(),instance.watch(keypath,set$$1),event({el:el,node:node,instance:instance,directives:directives,type:type,listener:function(){control.sync(data)}})},Yox=function(){function Yox(options){classCallCheck(this,Yox);var instance=this;execute(options[BEFORE_CREATE],instance,options);var el=options.el,data=options.data,props=options.props,parent=options.parent,replace=options.replace,computed=options.computed,template=options.template,watchers=options.watchers,components=options.components,directives=options.directives,events=options.events,filters=options.filters,methods=options.methods,partials=options.partials,extensions=options.extensions;instance.$options=options,props&&!object(props)&&(props=NULL),props&&data&&!func(data)&&warn('Passing a "data" option should be a function.'),instance.$data=props||{},extend(instance.$data,func(data)?execute(data,instance):data),object(computed)&&(instance.$computedGetters={},instance.$computedSetters={},instance.$computedStack=[],instance.$computedDeps={},each$1(computed,function(item,keypath){var get$$1=void 0,set$$1=void 0,deps=void 0,cache=TRUE;func(item)?get$$1=item:object(item)&&(boolean(item.cache)&&(cache=item.cache),array(item.deps)&&(deps=item.deps),func(item.get)&&(get$$1=item.get),func(item.set)&&(set$$1=item.set)),get$$1&&!function(){var watcher=function(){getter.$dirty=TRUE},getter=function getter(){if(getter.$dirty)delete getter.$dirty;else if(cache&&has$1($watchCache,keypath))return $watchCache[keypath];deps||instance.$computedStack.push([]);var result=execute(get$$1,instance),newDeps=deps||instance.$computedStack.pop(),oldDeps=instance.$computedDeps[keypath];return newDeps!==oldDeps&&updateDeps(instance,newDeps,oldDeps,watcher),instance.$computedDeps[keypath]=newDeps,$watchCache[keypath]=result,result};getter.toString=getter,instance.$computedGetters[keypath]=getter}(),set$$1&&(instance.$computedSetters[keypath]=set$$1)})),instance.$eventEmitter=new Emitter,instance.on(events);var $watchCache=instance.$watchCache={};instance.$watchEmitter=new Emitter({afterAdd:function(added){each(added,function(keypath){has$2(keypath,CHAR_ASTERISK)||has$1($watchCache,keypath)||($watchCache[keypath]=instance.get(keypath))})},afterRemove:function(removed){each(removed,function(keypath){has$1($watchCache,keypath)&&delete $watchCache[keypath]})}}),instance.watch(watchers),execute(options[AFTER_CREATE],instance),string(template)?(selector.test(template)&&(template=getContent(template)),tag.test(template)||error$1('Passing a "template" option must have a root element.')):template=NULL,string(el)&&selector.test(el)&&(el=find$1(el)),el&&(isElement$1(el)?replace||(el=create$1("div",el)):error$1('Passing a "el" option must be a html element.')),parent&&(instance.$parent=parent),methods&&each$1(methods,function(fn,name){has$1(prototype,name)&&error$1('Passing a "'+name+'" method is conflicted with built-in methods.'),instance[name]=fn}),extend(instance,extensions),instance.component(components),instance.directive(directives),instance.filter(filters),instance.partial(partials),template&&(instance.$viewWatcher=function(){instance.$dirty=TRUE},execute(options[BEFORE_MOUNT],instance),instance.$template=Yox.compile(template),instance.updateView(el||create$1("div")))}return createClass(Yox,[{key:"get",value:function(keypath,context){var $data=this.$data,$computedStack=this.$computedStack,$computedGetters=this.$computedGetters,result=void 0,getValue=function(keypath){return $computedGetters&&(result=$computedGetters[keypath])?{value:result()}:get($data,keypath)};if(keypath=normalize(keypath),string(context))for(var keys$$1=parse$1(context);TRUE;){if(push(keys$$1,keypath),context=stringify(keys$$1),result=getValue(context),result||keys$$1.length<=1)return result&&(result.keypath=context),result;keys$$1.splice(-2,2)}else if($computedStack&&(result=last($computedStack),result&&push(result,keypath)),result=getValue(keypath))return result.value}},{key:"set",value:function(keypath,value){var model$$1=void 0,immediate=void 0;if(string(keypath))model$$1={},model$$1[keypath]=value;else{if(!object(keypath))return;model$$1=copy(keypath),immediate=value===TRUE}this.updateModel(model$$1,immediate)}},{key:"on",value:function(type,listener){this.$eventEmitter.on(type,listener)}},{key:"once",value:function(type,listener){this.$eventEmitter.once(type,listener)}},{key:"off",value:function(type,listener){this.$eventEmitter.off(type,listener)}},{key:"fire",value:function(type,data){var event$$1=data;event$$1 instanceof Event||(event$$1=new Event(type),data&&(event$$1.data=data)),event$$1.type!==type&&(data=event$$1.data,event$$1=new Event(event$$1),event$$1.type=type,data&&(event$$1.data=data));var instance=this,$parent=instance.$parent,$eventEmitter=instance.$eventEmitter;event$$1.target||(event$$1.target=instance);var done=$eventEmitter.fire(type,event$$1,instance);return done&&$parent&&(done=$parent.fire(type,event$$1)),done}},{key:"watch",value:function(keypath,watcher){this.$watchEmitter.on(keypath,watcher)}},{key:"watchOnce",value:function(keypath,watcher){this.$watchEmitter.once(keypath,watcher)}},{key:"unwatch",value:function(keypath,watcher){this.$watchEmitter.off(keypath,watcher)}},{key:"updateModel",value:function(model$$1){var instance=this,$data=instance.$data,$computedSetters=instance.$computedSetters;each$1(model$$1,function(newValue,key){var keypath=normalize(key);keypath!==key&&(delete model$$1[key],model$$1[keypath]=newValue)}),each$1(model$$1,function(value,keypath){if($computedSetters){var setter=$computedSetters[keypath];if(setter)return void setter.call(instance,value)}set($data,keypath,value)});var args=arguments,immediate=void 0;1===args.length?immediate=instance.$dirtyIgnore=TRUE:2===args.length&&(immediate=args[1]),immediate?diff(instance):instance.$diffing||(instance.$diffing=TRUE,add$1(function(){delete instance.$diffing,diff(instance)}))}},{key:"updateView",value:function(){var instance=this,$viewDeps=instance.$viewDeps,$viewWatcher=instance.$viewWatcher,$data=instance.$data,$options=instance.$options,$filters=instance.$filters,$template=instance.$template,$currentNode=instance.$currentNode,$computedGetters=instance.$computedGetters;$currentNode&&execute($options[BEFORE_UPDATE],instance);var context={},filter=registry.filter;extend(context,filter&&filter.data,$filters.data),each$1(context,function(value,key){func(value)&&(context[key]=value.bind(instance))}),extend(context,$data,$computedGetters);var _vdom$create=create($template,context,instance),node=_vdom$create.node,deps=_vdom$create.deps;instance.$viewDeps=keys(deps),updateDeps(instance,instance.$viewDeps,$viewDeps,$viewWatcher);var afterHook=void 0;$currentNode?(afterHook=AFTER_UPDATE,$currentNode=patch($currentNode,node)):(afterHook=AFTER_MOUNT,$currentNode=patch(arguments[0],node),instance.$el=$currentNode.el),instance.$currentNode=$currentNode,execute($options[afterHook],instance)}},{key:"create",value:function(options,extra){options=extend({},options,extra);var _options=options,props=_options.props,propTypes=_options.propTypes;object(props)&&object(propTypes)&&(options.props=Yox.validate(props,propTypes)),options.parent=this;var child=new Yox(options),children=this.$children||(this.$children=[]);return push(children,child),child}},{key:"compileValue",value:function(keypath,value){if(!falsy$1(value)){var instance=this;if(!(indexOf$1(value,CHAR_OPAREN)>0))return function(event$$1){instance.fire(value,event$$1)};var _ret2=function(){var ast=compile$1(value);return ast.type===CALL?{v:function(event$$1){var isEvent=event$$1 instanceof Event,args=copy(ast.args);args.length?args=args.map(function(node){var name=node.name,type=node.type;if(type===LITERAL)return node.value;if(type===IDENTIFIER){if(name===SPECIAL_EVENT){if(isEvent)return event$$1}else if(name===SPECIAL_KEYPATH)return keypath}else type===MEMBER&&(name=stringify$1(node));var result=instance.get(name,keypath);return result?result.value:void 0}):isEvent&&push(args,event$$1);var name=stringify$1(ast.callee),fn=instance[name];if(!fn){var result=instance.get(name,keypath);result&&(fn=result.value)}execute(fn,instance,args)}}:void 0}();return"object"===("undefined"==typeof _ret2?"undefined":_typeof(_ret2))?_ret2.v:void 0}}},{key:"destroy",value:function(){var instance=this,$options=instance.$options,$parent=instance.$parent,$children=instance.$children,$currentNode=instance.$currentNode,$watchEmitter=instance.$watchEmitter,$eventEmitter=instance.$eventEmitter;execute($options[BEFORE_DESTROY],instance),$children&&each($children,function(child){child.destroy()},TRUE),$parent&&$parent.$children&&remove($parent.$children,instance),$currentNode&&arguments[0]!==TRUE&&patch($currentNode,{text:CHAR_BLANK}),$watchEmitter.off(),$eventEmitter.off(),each$1(instance,function(value,key){delete instance[key]}),execute($options[AFTER_DESTROY],instance)}},{key:"nextTick",value:function(fn){add$1(fn)}},{key:"toggle",value:function(keypath){var value=!this.get(keypath);return this.set(keypath,value),value}},{key:"increase",value:function(keypath,step,max){var value=toNumber(this.get(keypath),0)+(numeric(step)?step:1);return(!numeric(max)||max>=value)&&this.set(keypath,value),value}},{key:"decrease",value:function(keypath,step,min){var value=toNumber(this.get(keypath),0)-(numeric(step)?step:1);return(!numeric(min)||value>=min)&&this.set(keypath,value),value}},{key:"copy",value:function(data,deep){return copy(data,deep)}},{key:"log",value:function(msg){log(msg)}},{key:"warn",value:function(msg){warn(msg)}}]),Yox}();Yox.version="0.26.0",Yox.is=is$1,Yox.array=array$1,Yox.object=object$1,Yox.string=string$1,Yox["native"]=native,Yox.Event=Event,Yox.Emitter=Emitter;var prototype=Yox.prototype,registry={},supportRegisterAsync=["component"];return each(merge(supportRegisterAsync,["directive","filter","partial"]),function(type){prototype[type]=function(){var prop="$"+type+"s",store=this[prop]||(this[prop]=new Store),_parseRegisterArgumen=parseRegisterArguments(type,arguments),args=_parseRegisterArgumen.args,callback=_parseRegisterArgumen.callback;return magic({args:args,get:function(id){return callback?void store.getAsync(id,function(value){value?callback(value):Yox[type](id,callback)}):store.get(id)||Yox[type](id)},set:function(id,value){store.set(id,value)}})},Yox[type]=function(){var store=registry[type]||(registry[type]=new Store),_parseRegisterArgumen2=parseRegisterArguments(type,arguments),args=_parseRegisterArgumen2.args,callback=_parseRegisterArgumen2.callback;return magic({args:args,get:function(id){return callback?void store.getAsync(id,callback):store.get(id)},set:function(id,value){store.set(id,value)}})}}),Yox.nextTick=add$1,Yox.compile=function(template){return falsy$1(template)?template:compile$$1(template)},Yox.validate=function(props,schema){var result={};return each$1(schema,function(rule,key){var type=rule.type,value=rule.value,required=rule.required;required=required===TRUE||func(required)&&required(props),has$1(props,key)?type&&!function(){var target=props[key],matched=void 0;falsy$1(type)?falsy(type)?func(type)&&(matched=type(target,props)):each(type,function(t){return is(target,t)?(matched=TRUE,FALSE):void 0}):matched=is(target,type),matched===TRUE?result[key]=target:required&&warn('Passing a "'+key+'" prop is not matched.')}():required?warn('Passing a "'+key+'" prop is not found.'):has$1(rule,"value")&&(result[key]=func(value)?value(props):value)}),result},Yox.use=function(plugin){plugin.install(Yox)},Yox.directive({ref:ref,event:event,model:model}),Yox});